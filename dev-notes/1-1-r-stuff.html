<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Rstanarm Developer Notes" />
<meta property="og:type" content="book" />
<meta property="og:url" content="https://mc-stan.org/rstanarm/index.html" />
<meta property="og:image" content="https://mc-stan.org/rstanarm/index.htmlimages/logo.png" />

<meta name="github-repo" content="stan-dev/rstanarm" />

<meta name="author" content="Stan Development Team" />

<meta name="date" content="2017-06-16" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Rstanarm Developer Notes">

<title>Rstanarm Developer Notes</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#rstanarm-developer-notes">Rstanarm Developer Notes</a></li>
<li class="has-sub"><a href="1-model-fitting.html#model-fitting"><span class="toc-section-number">1</span> Model Fitting</a><ul>
<li class="has-sub"><a href="1-1-r-stuff.html#r-stuff"><span class="toc-section-number">1.1</span> R Stuff</a><ul>
<li><a href="1-1-r-stuff.html#tips"><span class="toc-section-number">1.1.1</span> Tips</a></li>
</ul></li>
<li class="has-sub"><a href="1-2-stan-stuff.html#stan-stuff"><span class="toc-section-number">1.2</span> Stan Stuff</a><ul>
<li><a href="1-2-stan-stuff.html#tips-1"><span class="toc-section-number">1.2.1</span> Tips</a></li>
</ul></li>
<li><a href="1-3-priors.html#priors"><span class="toc-section-number">1.3</span> Priors</a></li>
</ul></li>
<li><a href="2-rstanreg-r.html#rstanreg.r"><span class="toc-section-number">2</span> <code>R/stanreg.R</code></a></li>
<li class="has-sub"><a href="3-methods.html#methods"><span class="toc-section-number">3</span> Methods</a><ul>
<li><a href="3-1-predict.html#predict"><span class="toc-section-number">3.1</span> <code>predict</code></a></li>
<li><a href="3-2-posterior-predict.html#posterior_predict"><span class="toc-section-number">3.2</span> <code>posterior_predict</code></a></li>
<li><a href="3-3-posterior-linpred.html#posterior_linpred"><span class="toc-section-number">3.3</span> <code>posterior_linpred</code></a></li>
<li class="has-sub"><a href="3-4-loo-and-log-lik.html#loo-and-log_lik"><span class="toc-section-number">3.4</span> <code>loo</code> and <code>log_lik</code></a><ul>
<li><a href="3-4-loo-and-log-lik.html#llfun"><span class="toc-section-number">3.4.1</span> <code>llfun</code></a></li>
<li><a href="3-4-loo-and-log-lik.html#llargs"><span class="toc-section-number">3.4.2</span> <code>llargs</code></a></li>
</ul></li>
<li><a href="3-5-prior-summary.html#prior_summary"><span class="toc-section-number">3.5</span> <code>prior_summary</code></a></li>
</ul></li>
<li><a href="4-documentation-and-examples.html#documentation-and-examples"><span class="toc-section-number">4</span> Documentation and Examples</a></li>
<li><a href="5-testing.html#testing"><span class="toc-section-number">5</span> Testing</a></li>
<li><a href="6-vignettes.html#vignettes"><span class="toc-section-number">6</span> Vignettes</a></li>
<li><a href="7-an-outline-of-what-goes-where.html#an-outline-of-what-goes-where"><span class="toc-section-number">7</span> An outline of what goes where</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="r-stuff" class="section level2">
<h2><span class="header-section-number">1.1</span> R Stuff</h2>
<p>First add the package you plan on emulating in the <code>DESCRIPTION</code> file under <code>suggests:</code>.</p>
<p>You’ll need to write an rstanarm function for each of the models you plan on emulating. These functions should call a .fit workhorse function which will run Stan. Essentially, the workflow will look something like the following:</p>
<pre><code>┏━━━━━━ USER ━━━━━━┓
model_A.R                  model_B.R
┗━━━━ model.fit ━━━━┛
┃
model.stan</code></pre>
<p>Regarding the above diagram, the <code>model_*.R</code> and <code>model.fit</code> files are in the <code>R</code> folder and the <code>model.stan</code> file is in the <code>exec</code> folder. You should include existing snippets of stan code in your <code>model.stan</code> file. These are located in the <code>inst/chunks</code> folder.</p>
<p>In the .fit function you should,</p>
<ul>
<li>Center the covariates (if there is an intercept).</li>
<li>Perform QR decomposition.</li>
<li>Determine whether the intercept is declared (or whether multiple linear predictors have been declared).</li>
<li>Extract and process information regarding the priors declared.</li>
<li>Define the parameters that you want Stan to return as a vector of strings <code>pars</code>.</li>
<li>Put together data as a list that can be called into rstan.</li>
</ul>
<p>Conditionals should be set up so that the .fit workhorse function can deal with the following algorithm arguments.</p>
<ul>
<li><code>'optimizing'</code></li>
<li><code>'sampling'</code></li>
<li><code>'fullrank'</code> and <code>'meanfield'</code> (Variational Bayes methods)</li>
</ul>
<div id="tips" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Tips</h3>
<ul>
<li>If you added a new argument to your modeling function and are wondering why the argument is not recognized when you run the function (after building the package) it’s probably because you haven’t NULLified the argument in the <code>match.call(expand.dots = FALSE)</code> list.</li>
<li>If Stan isn’t returning parameters that are in the model make sure you’ve specified them in <code>pars</code>.</li>
<li>If the model’s family is using an existing family but the model linear predictor, etc. is different then it might be a good idea to give it an additional class identifier: <code>class(out) &lt;- c(&quot;stanreg&quot;, &quot;additional_class&quot;)</code></li>
</ul>
</div>
</div>
<p style="text-align: center;">
<a href="1-model-fitting.html"><button class="btn btn-default">Previous</button></a>
<a href="1-2-stan-stuff.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
