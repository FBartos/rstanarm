<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Rstanarm Developer Notes" />
<meta property="og:type" content="book" />
<meta property="og:url" content="https://mc-stan.org/rstanarm/index.html" />
<meta property="og:image" content="https://mc-stan.org/rstanarm/index.htmlimages/logo.png" />

<meta name="github-repo" content="stan-dev/rstanarm" />

<meta name="author" content="Stan Development Team" />

<meta name="date" content="2017-06-16" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Rstanarm Developer Notes">

<title>Rstanarm Developer Notes</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#rstanarm-developer-notes">Rstanarm Developer Notes</a></li>
<li class="has-sub"><a href="1-model-fitting.html#model-fitting"><span class="toc-section-number">1</span> Model Fitting</a><ul>
<li class="has-sub"><a href="1-1-r-stuff.html#r-stuff"><span class="toc-section-number">1.1</span> R Stuff</a><ul>
<li><a href="1-1-r-stuff.html#tips"><span class="toc-section-number">1.1.1</span> Tips</a></li>
</ul></li>
<li class="has-sub"><a href="1-2-stan-stuff.html#stan-stuff"><span class="toc-section-number">1.2</span> Stan Stuff</a><ul>
<li><a href="1-2-stan-stuff.html#tips-1"><span class="toc-section-number">1.2.1</span> Tips</a></li>
</ul></li>
<li><a href="1-3-priors.html#priors"><span class="toc-section-number">1.3</span> Priors</a></li>
</ul></li>
<li><a href="2-rstanreg-r.html#rstanreg.r"><span class="toc-section-number">2</span> <code>R/stanreg.R</code></a></li>
<li class="has-sub"><a href="3-methods.html#methods"><span class="toc-section-number">3</span> Methods</a><ul>
<li><a href="3-1-predict.html#predict"><span class="toc-section-number">3.1</span> <code>predict</code></a></li>
<li><a href="3-2-posterior-predict.html#posterior_predict"><span class="toc-section-number">3.2</span> <code>posterior_predict</code></a></li>
<li><a href="3-3-posterior-linpred.html#posterior_linpred"><span class="toc-section-number">3.3</span> <code>posterior_linpred</code></a></li>
<li class="has-sub"><a href="3-4-loo-and-log-lik.html#loo-and-log_lik"><span class="toc-section-number">3.4</span> <code>loo</code> and <code>log_lik</code></a><ul>
<li><a href="3-4-loo-and-log-lik.html#llfun"><span class="toc-section-number">3.4.1</span> <code>llfun</code></a></li>
<li><a href="3-4-loo-and-log-lik.html#llargs"><span class="toc-section-number">3.4.2</span> <code>llargs</code></a></li>
</ul></li>
<li><a href="3-5-prior-summary.html#prior_summary"><span class="toc-section-number">3.5</span> <code>prior_summary</code></a></li>
</ul></li>
<li><a href="4-documentation-and-examples.html#documentation-and-examples"><span class="toc-section-number">4</span> Documentation and Examples</a></li>
<li><a href="5-testing.html#testing"><span class="toc-section-number">5</span> Testing</a></li>
<li><a href="6-vignettes.html#vignettes"><span class="toc-section-number">6</span> Vignettes</a></li>
<li><a href="7-an-outline-of-what-goes-where.html#an-outline-of-what-goes-where"><span class="toc-section-number">7</span> An outline of what goes where</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="loo-and-log_lik" class="section level2">
<h2><span class="header-section-number">3.4</span> <code>loo</code> and <code>log_lik</code></h2>
<p>You need to check whether,</p>
<ol style="list-style-type: decimal">
<li><code>loo()</code> is using the correct log likelihood specified in <code>log_lik.R</code>. This is the log likelihood function that corresponds to <code>object$family</code> (or some other identifier that you can subset from <code>object</code>). If it does then you’re done.</li>
<li>If not then you need to specify the appropriate log likelihood to be used in <code>loo()</code>.</li>
</ol>
<p>Getting the loo function to work on a stanreg object can be tricky. It involves creating a log likelihood function for the posterior <code>llfun</code> and a set of arguments to be passed through this function <code>llargs</code>.</p>
<div id="llfun" class="section level3">
<h3><span class="header-section-number">3.4.1</span> <code>llfun</code></h3>
<p>The best way to think about this is that you want to create a <span class="math inline">\(S \times N\)</span> matrix point-wise log likelihood, where <span class="math inline">\(S\)</span> is the number of draws and <span class="math inline">\(N\)</span> is the number of observations (i.e. you’re evaluating the log-likelihood of the posterior for each datum and draw from the marginal posterior).</p>
<p>The approach taken with using loo on a stanreg object is to declare a function that iterates over the data, rather than specifying the entire point-wise log likelihood matrix.</p>
</div>
<div id="llargs" class="section level3">
<h3><span class="header-section-number">3.4.2</span> <code>llargs</code></h3>
<p>Within the <code>llargs</code> list <code>data</code> needs to be a data frame or matrix that can be iterated over <span class="math inline">\(N\)</span> times. <code>draws</code> should be a list containing the draws of <span class="math inline">\(S\)</span> dimension. One way to think about it is that data is what you need to iterate over and draws is fixed. <del>This is useful in cases where some variables may be considered as data but you don’t actually want to iterate over them, or in cases where you only have one observation and actually need to iterate over the draws (e.g. a multinormal outcome with correlated errors.)</del></p>
</div>
</div>
<p style="text-align: center;">
<a href="3-3-posterior-linpred.html"><button class="btn btn-default">Previous</button></a>
<a href="3-5-prior-summary.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
