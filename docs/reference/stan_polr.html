<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bayesian ordinal regression models via Stan — stan_polr • rstanarm</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rstanarm</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../Articles/index.html">Articles</a>
</li>
<li>
  <a href="https://htmlpreview.github.io/?https://github.com/stan-dev/rstanarm/blob/master/dev-notes/rstanarm_dev_notes.html">Develop</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian ordinal regression models via Stan</h1>
    </div>

    
    <p>Bayesian inference for ordinal (or binary) regression models under
a proportional odds assumption.</p>
    

    <pre class="usage"><span class='fu'>stan_polr</span>(<span class='no'>formula</span>, <span class='no'>data</span>, <span class='no'>weights</span>, <span class='no'>...</span>, <span class='no'>subset</span>,
  <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"na.action"</span>, <span class='st'>"na.omit"</span>), <span class='kw'>contrasts</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>model</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"logistic"</span>, <span class='st'>"probit"</span>, <span class='st'>"loglog"</span>, <span class='st'>"cloglog"</span>,
  <span class='st'>"cauchit"</span>), <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>R2</a></span>(<span class='fu'>stop</span>(<span class='st'>"'location' must be specified"</span>)),
  <span class='kw'>prior_counts</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>dirichlet</a></span>(<span class='fl'>1</span>), <span class='kw'>shape</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>rate</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prior_PD</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"sampling"</span>, <span class='st'>"meanfield"</span>, <span class='st'>"fullrank"</span>),
  <span class='kw'>adapt_delta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>do_residuals</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>stan_polr.fit</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>wt</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"logistic"</span>,
  <span class='st'>"probit"</span>, <span class='st'>"loglog"</span>, <span class='st'>"cloglog"</span>, <span class='st'>"cauchit"</span>), <span class='no'>...</span>,
  <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>R2</a></span>(<span class='fu'>stop</span>(<span class='st'>"'location' must be specified"</span>)),
  <span class='kw'>prior_counts</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>dirichlet</a></span>(<span class='fl'>1</span>), <span class='kw'>shape</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>rate</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prior_PD</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"sampling"</span>, <span class='st'>"meanfield"</span>, <span class='st'>"fullrank"</span>),
  <span class='kw'>adapt_delta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>do_residuals</span> <span class='kw'>=</span> <span class='no'>algorithm</span> <span class='kw'>==</span> <span class='st'>"sampling"</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula, data, subset</th>
      <td><p>Same as <code><a href='http://www.rdocumentation.org/packages/MASS/topics/polr'>polr</a></code>, 
but <em>we strongly advise against omitting the <code>data</code>
argument</em>. Unless <code>data</code> is specified (and is a data frame) many
post-estimation functions (including <code>update</code>, <code>loo</code>,
<code>kfold</code>) are not guaranteed to work properly.</p></td>
    </tr>
    <tr>
      <th>weights, na.action, contrasts, model</th>
      <td><p>Same as <code><a href='http://www.rdocumentation.org/packages/MASS/topics/polr'>polr</a></code>, but
rarely specified.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to the function in the <span class="pkg">rstan</span> 
package (<code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>sampling</a></code>, <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-vb'>vb</a></code>, or 
<code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-optimizing'>optimizing</a></code>), corresponding to the estimation method 
named by <code>algorithm</code>. For example, if <code>algorithm</code> is
<code>"sampling"</code> it is possibly to specify <code>iter</code>, <code>chains</code>,
<code>cores</code>, <code>refresh</code>, etc.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>One of 'logistic', 'probit', 'loglog', 'cloglog' or 'cauchit',
but can be abbreviated. See <code><a href='http://www.rdocumentation.org/packages/MASS/topics/polr'>polr</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>Prior for coefficients. Should be a call to <code><a href='priors.html'>R2</a></code>
to specify the prior location of the \(R^2\) but can be <code>NULL</code>
to indicate a standard uniform prior. See <code><a href='priors.html'>priors</a></code>.</p></td>
    </tr>
    <tr>
      <th>prior_counts</th>
      <td><p>A call to <code><a href='priors.html'>dirichlet</a></code> to specify the
prior counts of the outcome when the predictors are at their sample
means.</p></td>
    </tr>
    <tr>
      <th>shape</th>
      <td><p>Either <code>NULL</code> or a positive scalar that is interpreted
as the shape parameter for a <code><a href='http://www.rdocumentation.org/packages/stats/topics/GammaDist'>GammaDist</a></code>ribution on
the exponent applied to the probability of success when there are only
two outcome categories. If <code>NULL</code>, which is the default, then the
exponent is taken to be fixed at \(1\).</p></td>
    </tr>
    <tr>
      <th>rate</th>
      <td><p>Either <code>NULL</code> or a positive scalar that is interpreted
as the rate parameter for a <code><a href='http://www.rdocumentation.org/packages/stats/topics/GammaDist'>GammaDist</a></code>ribution on
the exponent applied to the probability of success when there are only
two outcome categories. If <code>NULL</code>, which is the default, then the
exponent is taken to be fixed at \(1\).</p></td>
    </tr>
    <tr>
      <th>prior_PD</th>
      <td><p>A logical scalar (defaulting to <code>FALSE</code>) indicating
whether to draw from the prior predictive distribution instead of
conditioning on the outcome.</p></td>
    </tr>
    <tr>
      <th>algorithm</th>
      <td><p>A string (possibly abbreviated) indicating the 
estimation approach to use. Can be <code>"sampling"</code> for MCMC (the
default), <code>"optimizing"</code> for optimization, <code>"meanfield"</code> for
variational inference with independent normal distributions, or
<code>"fullrank"</code> for variational inference with a multivariate normal
distribution. See <code><a href='rstanarm-package.html'>rstanarm-package</a></code> for more details on the
estimation algorithms. NOTE: not all fitting functions support all four
algorithms.</p></td>
    </tr>
    <tr>
      <th>adapt_delta</th>
      <td><p>Only relevant if <code>algorithm="sampling"</code>. See 
<code><a href='adapt_delta.html'>adapt_delta</a></code> for details.</p></td>
    </tr>
    <tr>
      <th>do_residuals</th>
      <td><p>A logical scalar indicating whether or not to 
automatically calculate fit residuals after sampling completes. Defaults to
<code>TRUE</code> if and only if <code>algorithm="sampling"</code>. Setting
<code>do_residuals=FALSE</code> is only useful in the somewhat rare case that
<code>stan_polr</code> appears to finish sampling but hangs instead of returning
the fitted model object.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A design matrix.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>A response variable, which must be a (preferably ordered) factor.</p></td>
    </tr>
    <tr>
      <th>wt</th>
      <td><p>A numeric vector (possibly <code>NULL</code>) of observation weights.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>A numeric vector (possibly <code>NULL</code>) of offsets.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <a href='stanreg-objects.html'>stanreg</a> object is returned 
for <code>stan_polr</code>.</p>
<p>A stanfit object (or a slightly modified 
  stanfit object) is returned if <code>stan_polr.fit</code> is called directly.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>stan_polr</code> function is similar in syntax to
  <code><a href='http://www.rdocumentation.org/packages/MASS/topics/polr'>polr</a></code> but rather than performing maximum likelihood
  estimation of a proportional odds model, Bayesian estimation is performed
  (if <code>algorithm = "sampling"</code>) via MCMC. The <code>stan_polr</code>
  function calls the workhorse <code>stan_polr.fit</code> function, but it is
  possible to call the latter directly.</p>
<p>As for <code><a href='stan_lm.html'>stan_lm</a></code>, it is necessary to specify the prior
  location of \(R^2\). In this case, the \(R^2\) pertains to the
  proportion of variance in the latent variable (which is discretized
  by the cutpoints) attributable to the predictors in the model.</p>
<p>Prior beliefs about the cutpoints are governed by prior beliefs about the
  outcome when the predictors are at their sample means. Both of these
  are explained in the help page on <code><a href='priors.html'>priors</a></code> and in the
  <span class="pkg">rstanarm</span> vignettes.</p>
<p>Unlike <code><a href='http://www.rdocumentation.org/packages/MASS/topics/polr'>polr</a></code>, <code>stan_polr</code> also allows the "ordinal"
  outcome to contain only two levels, in which case the likelihood is the
  same by default as for <code><a href='stan_glm.html'>stan_glm</a></code> with <code>family = binomial</code>
  but the prior on the coefficients is different. However, <code>stan_polr</code>
  allows the user to specify the <code>shape</code> and <code>rate</code> hyperparameters,
  in which case the probability of success is defined as the logistic CDF of
  the linear predictor, raised to the power of <code>alpha</code> where <code>alpha</code>
  has a gamma prior with the specified <code>shape</code> and <code>rate</code>. This
  likelihood is called &#8220;scobit&#8221; by Nagler (1994) because if <code>alpha</code>
  is not equal to \(1\), then the relationship between the linear predictor
  and the probability of success is skewed. If <code>shape</code> or <code>rate</code> is
  <code>NULL</code>, then <code>alpha</code> is assumed to be fixed to \(1\).</p>
<p>Otherwise, it is usually advisible to set <code>shape</code> and <code>rate</code> to
  the same number so that the expected value of <code>alpha</code> is \(1\) while
  leaving open the possibility that <code>alpha</code> may depart from \(1\) a
  little bit. It is often necessary to have a lot of data in order to estimate
  <code>alpha</code> with much precision and always necessary to inspect the
  Pareto shape parameters calculated by <code><a href='loo.stanreg.html'>loo</a></code> to see if the
  results are particularly sensitive to individual observations.</p>
<p>Users should think carefully about how the outcome is coded when using
  a scobit-type model. When <code>alpha</code> is not \(1\), the asymmetry
  implies that the probability of success is most sensitive to the predictors
  when the probability of success is less than \(0.63\). Reversing the
  coding of the successes and failures allows the predictors to have the
  greatest impact when the probability of failure is less than \(0.63\).
  Also, the gamma prior on <code>alpha</code> is positively skewed, but you
  can reverse the coding of the successes and failures to circumvent this
  property.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Nagler, J., (1994). Scobit: An Alternative Estimator to Logit and Probit.
<em>American Journal of Political Science</em>. 230 -- 255.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='stanreg-methods.html'>stanreg-methods</a></code> and 
<code><a href='http://www.rdocumentation.org/packages/MASS/topics/polr'>polr</a></code>.</p>
<p>The vignette for <code>stan_polr</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (!<span class='fu'>grepl</span>(<span class='st'>"^sparc"</span>,  <span class='no'>R.version</span>$<span class='no'>platform</span>)) {
 <span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>stan_polr</span>(<span class='no'>tobgp</span> ~ <span class='no'>agegp</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>esoph</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"probit"</span>,
          <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>R2</a></span>(<span class='fl'>0.2</span>, <span class='st'>"mean"</span>), <span class='kw'>init_r</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>12345</span>,
          <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='st'>"fullrank"</span>) <span class='co'># for speed only</span>
 <span class='fu'>print</span>(<span class='no'>fit</span>)
 <span class='fu'>plot</span>(<span class='no'>fit</span>)
}</div><div class='output co'>#&gt; 
#&gt; This is Automatic Differentiation Variational Inference.
#&gt; 
#&gt; (EXPERIMENTAL ALGORITHM: expect frequent updates to the procedure.)
#&gt; 
#&gt; Gradient evaluation took 5e-05 seconds
#&gt; 1000 iterations under these settings should take 0.05 seconds.
#&gt; Adjust your expectations accordingly!
#&gt; 
#&gt; Begin eta adaptation.
#&gt; Iteration:   1 / 250 [  0%]  (Adaptation)
#&gt; Iteration:  50 / 250 [ 20%]  (Adaptation)
#&gt; Iteration: 100 / 250 [ 40%]  (Adaptation)
#&gt; Iteration: 150 / 250 [ 60%]  (Adaptation)
#&gt; Iteration: 200 / 250 [ 80%]  (Adaptation)
#&gt; Success! Found best value [eta = 1] earlier than expected.
#&gt; 
#&gt; Begin stochastic gradient ascent.
#&gt;   iter       ELBO   delta_ELBO_mean   delta_ELBO_med   notes 
#&gt;    100     -1e+02             1.000            1.000
#&gt;    200     -1e+02             0.518            1.000
#&gt;    300     -1e+02             0.348            0.036
#&gt;    400     -1e+02             0.263            0.036
#&gt;    500     -1e+02             0.211            0.009   MEDIAN ELBO CONVERGED
#&gt; 
#&gt; Drawing a sample of size 1000 from the approximate posterior... 
#&gt; COMPLETED.
#&gt; stan_polr
#&gt;  family:   ordered [probit]
#&gt;  formula:  tobgp ~ agegp
#&gt;  num. obs: 88
#&gt; ------
#&gt; 
#&gt; Estimates:
#&gt;         Median MAD_SD
#&gt; agegp.L -0.1    0.3  
#&gt; agegp.Q -0.1    0.3  
#&gt; agegp.C  0.0    0.2  
#&gt; agegp^4  0.0    0.2  
#&gt; agegp^5  0.0    0.2  
#&gt; 
#&gt; Cutpoints:
#&gt;                Median MAD_SD
#&gt; 0-9g/day|10-19 -0.6    0.2  
#&gt; 10-19|20-29     0.1    0.2  
#&gt; 20-29|30+       0.8    0.2  
#&gt; 
#&gt; Sample avg. posterior predictive 
#&gt; distribution of y (X = xbar):
#&gt;                   Median MAD_SD
#&gt; mean_PPD:0-9g/day 0.3    0.1   
#&gt; mean_PPD:10-19    0.3    0.1   
#&gt; mean_PPD:20-29    0.2    0.1   
#&gt; mean_PPD:30+      0.2    0.1   
#&gt; 
#&gt; ------
#&gt; For info on the priors used see help('prior_summary.stanreg').</div><img src='stan_polr-3.png' alt='' width='540' height='400' /><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
