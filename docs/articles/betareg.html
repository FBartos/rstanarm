<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling Rates/Proportions using Beta Regression with rstanarm • rstanarm</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rstanarm</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../Articles/index.html">Articles</a>
</li>
<li>
  <a href="https://htmlpreview.github.io/?https://github.com/stan-dev/rstanarm/blob/master/dev-notes/rstanarm_dev_notes.html">Develop</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Modeling Rates/Proportions using Beta Regression with rstanarm</h1>
                        <h4 class="author">Imad Ali, Jonah Gabry and Ben Goodrich</h4>
            
            <h4 class="date">2017-06-15</h4>
          </div>

    
    
<div class="contents">
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_betareg: Models for Rate/Proportion Data}
-->
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette explains how to model continuous outcomes on the open unit interval using the <code>stan_betareg</code> function in the <strong>rstanarm</strong> package.</p>
<p>Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong> Package”</a>. This vignette focuses on Step 1 when the likelihood is the product of beta distributions.</p>
</div>
<div id="likelihood" class="section level1">
<h1 class="hasAnchor">
<a href="#likelihood" class="anchor"></a>Likelihood</h1>
<p>Beta regression uses the beta distribution as the likelihood for the data, <span class="math display">\[
f(y_i | a, b) = \frac{y_i^{(a-1)}(1-y_i)^{(b-1)}}{B(a,b)}
\]</span> where <span class="math inline">\(B(\cdot)\)</span> is the beta function. The shape parameters for the distribution are <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and enter into the model according to the following transformations, <span class="math display">\[
a = \mu\cdot\phi \\
b = (1-\mu)\cdot\phi
\]</span></p>
<p>Let <span class="math inline">\(g_1(\cdot)\)</span> be some link function. Then, in the specification of the shape parameters above, <span class="math inline">\(\mu = g_1^{-1}(\mathbf{X}\boldsymbol{\beta})\)</span>, where <span class="math inline">\(\boldsymbol{X}\)</span> is a <span class="math inline">\(N\times K\)</span> dimensional matrix of predictors, and <span class="math inline">\(\boldsymbol{\beta}\)</span> is a <span class="math inline">\(K\)</span> dimensional vector of parameters associated with each predictor.</p>
<p>In the simplest case (with only one set of regressors), <span class="math inline">\(\phi\)</span> is a scalar parameter. Alternatively, it is possible to model <span class="math inline">\(\phi\)</span> using a second set of regressors <span class="math inline">\(\mathbf{Z}\)</span>. In this context let <span class="math inline">\(g_2(\cdot)\)</span> be some link function that is not neccessarily identical to <span class="math inline">\(g_1(\cdot)\)</span>. Then <span class="math inline">\(\phi = g_2^{-1}(\mathbf{Z}\boldsymbol{\gamma})\)</span>, where <span class="math inline">\(\boldsymbol{\gamma}\)</span> is a <span class="math inline">\(J\)</span> dimensional vector of parameters associated with the <span class="math inline">\(N\times J\)</span> dimensional matrix of predictors <span class="math inline">\(\mathbf{Z}\)</span>.</p>
<p>After substituting the shape parameter values in, the likelihood used in beta regression takes the following form, <span class="math display">\[
f(y_i | \mu, \phi) = \frac{y_i^{(\mu\phi-1)}(1-y_i)^{((1-\mu)\phi-1)}}{B(\mu\phi,(1-\mu)\phi)}
\]</span></p>
</div>
<div id="priors" class="section level1">
<h1 class="hasAnchor">
<a href="#priors" class="anchor"></a>Priors</h1>
<p>A full Bayesian analysis requires specifying prior distributions <span class="math inline">\(f(\boldsymbol{\beta})\)</span> and <span class="math inline">\(f(\phi)\)</span> for the vector of regression coefficients and <span class="math inline">\(\phi\)</span>. When using <code>stan_betareg</code>, these distributions can be set using the <code>prior_intercept</code>, <code>prior</code>, and <code>prior_phi</code> arguments. The <code>stan_betareg</code> function supports a variety of prior distributions, which are explained in the <strong>rstanarm</strong> documentation (<code>help(priors, package = 'rstanarm')</code>).</p>
<p>When modeling <span class="math inline">\(\phi\)</span> with a linear predictor a full Bayesian analysis requires specifying the prior distributions <span class="math inline">\(f(\boldsymbol{\beta})\)</span> and <span class="math inline">\(f(\boldsymbol{\gamma})\)</span>. In <code>stan_betareg</code> the prior distributions on <span class="math inline">\(\boldsymbol{\gamma}\)</span> can be set using the <code>prior_intercept_z</code> and <code>prior_z</code> arguments.</p>
<p>As an example, suppose we have <span class="math inline">\(K\)</span> predictors and believe — prior to seeing the data — that <span class="math inline">\(\beta_1, \dots, \beta_K\)</span> and <span class="math inline">\(\phi\)</span> are as likely to be positive as they are to be negative, but are highly unlikely to be far from zero. These beliefs can be represented by normal distributions with mean zero and a small scale (standard deviation). To give <span class="math inline">\(\phi\)</span> and each of the <span class="math inline">\(\beta\)</span>s this prior (with a scale of 1, say), in the call to <code>stan_betareg</code> we would include the arguments <code>prior_intercept = normal(0,1)</code>, <code>prior = normal(0,1)</code>, and <code>prior_phi = normal(0,1)</code>.</p>
<p>If, on the other hand, we have less a priori confidence that the parameters will be close to zero then we could use a larger scale for the normal distribution and/or a distribution with heavier tails than the normal like the Student t distribution. <strong>Step 1</strong> in the “How to Use the <strong>rstanarm</strong> Package” vignette discusses one such example.</p>
<p>After fitting the model we can use the <code>prior_summary</code> function to print information about the prior distributions used when fitting the model.</p>
</div>
<div id="posterior" class="section level1">
<h1 class="hasAnchor">
<a href="#posterior" class="anchor"></a>Posterior</h1>
<p>When using only a <em>single set of regressors</em>, the posterior distribution of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\phi\)</span> is proportional to the product of the likelihood contributions, the <span class="math inline">\(K\)</span> priors on the <span class="math inline">\(\beta_k\)</span> parameters, and <span class="math inline">\(\phi\)</span>, <span class="math display">\[
f(\boldsymbol{\beta},\phi|\mathbf{y},\mathbf{X}) \propto 
\prod_{i=1}^N f(y_i | a, b) \times 
\prod_{k=1}^K f(\beta_k) \times
f(\phi)
\]</span></p>
<p>When using <em>two sets of regressors</em>, the posterior distribution of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\gamma}\)</span> is proportional to the product of the likelihood contribution, the <span class="math inline">\(K\)</span> priors on the <span class="math inline">\(\beta_k\)</span> parameters, and the <span class="math inline">\(J\)</span> priors on the <span class="math inline">\(\gamma_j\)</span> parameters,</p>
<p><span class="math display">\[
f(\boldsymbol{\beta},\boldsymbol{\gamma}|\mathbf{y},\mathbf{X}) \propto 
\prod_{i=1}^N f(y_i | a, b) \times 
\prod_{k=1}^K f(\beta_k) \times
\prod_{j=1}^J f(\gamma_j)
\]</span></p>
</div>
<div id="an-example-using-simulated-data" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-using-simulated-data" class="anchor"></a>An Example Using Simulated Data</h1>
<p>In this example the outcome variable <span class="math inline">\(\mathbf{y}\)</span> is simulated in a way that warrants the use of beta regression. It is worth mentioning that the data generation process is quite convoluted, which is apparent in the identification of the likelihood above.</p>
<p>The data simulated below uses the logistic link function on the first set of regressors and the log link function on the second set of regressors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SEED &lt;-<span class="st"> </span><span class="dv">1234</span>
<span class="kw">set.seed</span>(SEED)
eta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, -<span class="fl">0.2</span>)
gamma &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.8</span>, <span class="fl">0.4</span>)
N &lt;-<span class="st"> </span><span class="dv">200</span>
x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">2</span>, <span class="dv">2</span>)
z &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">2</span>)
mu &lt;-<span class="st"> </span><span class="kw">binomial</span>(<span class="dt">link =</span> logit)$<span class="kw">linkinv</span>(eta[<span class="dv">1</span>] +<span class="st"> </span>eta[<span class="dv">2</span>]*x)
phi &lt;-<span class="st"> </span><span class="kw">binomial</span>(<span class="dt">link =</span> log)$<span class="kw">linkinv</span>(gamma[<span class="dv">1</span>] +<span class="st"> </span>gamma[<span class="dv">2</span>]*z)
y &lt;-<span class="st"> </span><span class="kw">rbeta</span>(N, mu *<span class="st"> </span>phi, (<span class="dv">1</span> -<span class="st"> </span>mu) *<span class="st"> </span>phi)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(y, x, z))
<span class="kw">hist</span>(dat$y, <span class="dt">col =</span> <span class="st">"darkgrey"</span>, <span class="dt">border =</span> F, <span class="dt">main =</span> <span class="st">"Distribution of Outcome Variable"</span>, <span class="dt">xlab =</span> <span class="st">"y"</span>, <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">freq =</span> F)</code></pre></div>
<p>The model can be fit by calling <code>stan_betareg</code>, using the appropriate link functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstanarm)
fit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(y ~<span class="st"> </span>x |<span class="st"> </span>z, <span class="dt">data =</span> dat, <span class="dt">link =</span> <span class="st">"logit"</span>, <span class="dt">link.phi =</span> <span class="st">"log"</span>,
                     <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED, <span class="dt">iter =</span> ITER)
fit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(y ~<span class="st"> </span>-<span class="dv">1</span> +<span class="st"> </span>x , <span class="dt">data =</span> dat, <span class="dt">link =</span> <span class="st">"logit"</span>, <span class="dt">link.phi =</span> <span class="st">"log"</span>,
                     <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED, <span class="dt">iter =</span> ITER)
<span class="kw">round</span>(<span class="kw">coef</span>(fit1), <span class="dv">2</span>)
<span class="kw">round</span>(<span class="kw">coef</span>(fit2), <span class="dv">2</span>)</code></pre></div>
<p>For clarity we can use <code>prior_summary</code> to print the information about the prior distributions used to fit the models. The priors used in <code>fit1</code> are provided below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/prior_summary.stanreg.html">prior_summary</a></span>(fit1)</code></pre></div>
<p>The usual posterior analyses are available in <strong>rstanarm</strong>. The plots below illustrate simulated values of the outcome variable. The incorrect model noticeably fails to capture the top of the distribution consistently in comparison to the true model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(bayesplot)
<span class="kw">bayesplot_grid</span>(
  <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(fit1), <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(fit2), 
  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),  
  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>), 
  <span class="dt">titles =</span> <span class="kw">c</span>(<span class="st">"True Model: y ~ x | z"</span>, <span class="st">"False Model: y ~ x - 1"</span>),
  <span class="dt">grid_args =</span> <span class="kw">list</span>(<span class="dt">ncol =</span> <span class="dv">2</span>)
)</code></pre></div>
<p>We can also compare models by evaluating the expected log pointwise predictive density (<code>elpd</code>), which can be calculated using the <code>loo</code> method, which provides an interface for <strong>rstanarm</strong> models to the functionality in the <strong>loo</strong> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">loo1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(fit1)
loo2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(fit2)
<span class="kw"><a href="../reference/loo.stanreg.html">compare_models</a></span>(loo1, loo2)</code></pre></div>
<p>The difference in <code>elpd</code> is negative indicating that the expected predictive accuracy for the first model is higher.</p>
</div>
<div id="an-example-using-gasoline-data" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-using-gasoline-data" class="anchor"></a>An Example Using Gasoline Data</h1>
<p>In some applied contexts it may be necessary to work with an outcome variable that is a proportion. If the proportion is bound on the open unit interval then beta regression can be considered a reasonable estimation method. The <code>betareg</code> package provides a dataset on the proportion of crude oil converted to gasoline after distillation and fractionation. This variable is defined as yield. Below <code>stan_betareg</code> is used to model yield as a function of temperature, pressure, and the batch of conditions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstanarm)
<span class="kw">data</span>(<span class="st">"GasolineYield"</span>, <span class="dt">package =</span> <span class="st">"betareg"</span>)
gas_fit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(yield ~<span class="st"> </span>temp +<span class="st"> </span>batch, <span class="dt">data =</span> GasolineYield, <span class="dt">link =</span> <span class="st">"logit"</span>,
                         <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED, <span class="dt">iter =</span> ITER)
gas_fit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(yield ~<span class="st"> </span>temp +<span class="st"> </span>batch |<span class="st"> </span>pressure,
                         <span class="dt">data =</span> GasolineYield, <span class="dt">link =</span> <span class="st">"logit"</span>,
                         <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED, <span class="dt">iter =</span> ITER)
<span class="kw">round</span>(<span class="kw">coef</span>(gas_fit1), <span class="dv">2</span>)
<span class="kw">round</span>(<span class="kw">coef</span>(gas_fit2), <span class="dv">2</span>)</code></pre></div>
<p>The plots below illustrate simulated values of gasoline yield. While the first model accounts for variation in batch conditions its predictions looks somewhat uniform rather than resembling the peaked and right-skewed behavior of the true data. The second model does a somewhat better job at capturing the shape of the distribution, however its location is off as it is centered around 0.50 rather than 0.20.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">bayesplot_grid</span>(
  <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(gas_fit1), <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(gas_fit2), 
  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),  
  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>), 
  <span class="dt">titles =</span> <span class="kw">c</span>(<span class="st">"gas_fit1"</span>, <span class="st">"gas_fit2"</span>),
  <span class="dt">grid_args =</span> <span class="kw">list</span>(<span class="dt">ncol =</span> <span class="dv">2</span>)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gas_loo1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(gas_fit1)
gas_loo2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(gas_fit2)
<span class="kw"><a href="../reference/loo.stanreg.html">compare_models</a></span>(gas_loo1, gas_loo2)</code></pre></div>
<p>Evaluating the expected log predictive distribution using <code>loo</code> reveals that the second of the two models is slightly preferred. That said, in this case the standard error of the difference in <code>elpd</code> is large enough (relative to the difference itself) that we can’t say there is a definitive preference for the second model.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Ferrari, SLP and Cribari-Neto, F (2004) “Beta Regression for Modeling Rates and Proportions”. <em>Journal of Applied Statistics.</em> Vol. 31, No. 07, p799-815.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#likelihood">Likelihood</a></li>
      <li><a href="#priors">Priors</a></li>
      <li><a href="#posterior">Posterior</a></li>
      <li><a href="#an-example-using-simulated-data">An Example Using Simulated Data</a></li>
      <li><a href="#an-example-using-gasoline-data">An Example Using Gasoline Data</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
