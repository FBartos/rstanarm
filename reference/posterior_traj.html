<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate the subject-specific or marginal longitudinal trajectory — posterior_traj • rstanarm</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate the subject-specific or marginal longitudinal trajectory — posterior_traj" />
<meta property="og:description" content="This function allows us to generate an estimated longitudinal trajectory 
(either subject-specific, or by marginalising over the distribution of the 
group-specific parameters) based on draws from the posterior predictive 
distribution." />
<meta property="og:image" content="https://mc-stan.org/rstanarm/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanarm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.21.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../dev-notes/index.html">Develop</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior">posterior</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org">Stan</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate the subject-specific or marginal longitudinal trajectory</h1>
    <small class="dont-index">Source: <a href='https://github.com/stan-dev/rstanarm/blob/master/R/posterior_traj.R'><code>R/posterior_traj.R</code></a></small>
    <div class="hidden name"><code>posterior_traj.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function allows us to generate an estimated longitudinal trajectory 
(either subject-specific, or by marginalising over the distribution of the 
group-specific parameters) based on draws from the posterior predictive 
distribution.</p>
    </div>

    <pre class="usage"><span class='fu'>posterior_traj</span>(
  <span class='no'>object</span>,
  <span class='kw'>m</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>newdata</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>newdataLong</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>newdataEvent</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>interpolate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>extrapolate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>last_time</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prob</span> <span class='kw'>=</span> <span class='fl'>0.95</span>,
  <span class='no'>ids</span>,
  <span class='kw'>dynamic</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>1.5</span>,
  <span class='kw'>draws</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>return_matrix</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>A fitted model object returned by the 
<code><a href='stan_jm.html'>stan_jm</a></code> modelling function. See 
<code><a href='stanreg-objects.html'>stanreg-objects</a></code>.</p></td>
    </tr>
    <tr>
      <th>m</th>
      <td><p>Integer specifying the number or name of the submodel</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p><strong>Deprecated</strong>: please use <code>newdataLong</code> instead.
Optionally, a data frame in which to look for variables with
which to predict. If omitted, the model matrix is used. If <code>newdata</code>
is provided and any variables were transformed (e.g. rescaled) in the data
used to fit the model, then these variables must also be transformed in
<code>newdata</code>. This only applies if variables were transformed before
passing the data to one of the modeling functions and <em>not</em> if
transformations were specified inside the model formula.</p></td>
    </tr>
    <tr>
      <th>newdataLong, newdataEvent</th>
      <td><p>Optionally, a data frame (or in the case of 
<code>newdataLong</code> this can be a list of data frames) in which to look 
for variables with which to predict. If omitted, the model matrices are used. 
If new data is provided, then two options are available. Either one can
provide observed covariate and outcome data, collected up to some time 
<em>t</em>, and use this data to draw new individual-specific coefficients
(i.e. individual-level random effects). This is the default behaviour when 
new data is provided, determined by the argument <code>dynamic = TRUE</code>, and
requiring both <code>newdataLong</code> and <code>newdataEvent</code> to be specified.
Alternatively, one can specify <code>dynamic = FALSE</code>, and then predict 
using just covariate data, by marginalising over the distribution
of the group-specific coefficients; in this case, only <code>newdataLong</code>
needs to be specified and it only needs to be a single data frame with
the covariate data for the predictions for the one longitudinal submodel.</p></td>
    </tr>
    <tr>
      <th>interpolate</th>
      <td><p>A logical specifying whether to interpolate the estimated 
longitudinal trajectory in between the observation times. This can be used
to achieve a smooth estimate of the longitudinal trajectory across the 
entire follow up time. If <code>TRUE</code> then the interpolation can be further 
controlled using the <code>control</code> argument.</p></td>
    </tr>
    <tr>
      <th>extrapolate</th>
      <td><p>A logical specifying whether to extrapolate the estimated 
longitudinal trajectory beyond the time of the last known observation time.
If <code>TRUE</code> then the extrapolation can be further controlled using
the <code>control</code> argument.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A named list with parameters controlling the interpolation or
extrapolation of the estimated longitudinal trajectory when either 
<code>interpolate = TRUE</code> or <code>extrapolate = TRUE</code>. The 
list can contain one or more of the following named elements: <br /></p><dl'>
  <dt><code>ipoints</code></dt><dd><p>a positive integer specifying the number of discrete 
  time points at which to calculate the estimated longitudinal response for
  <code>interpolate = TRUE</code>. These time points are evenly spaced starting at 
  0 and ending at the last known observation time for each individual. The
  last observation time for each individual is taken to be either: the
  event or censoring time if no new data is provided; the time specified
  in the "last_time" column if provided in the new data (see <strong>Details</strong>
  section below); or the time of the last longitudinal measurement if new
  data is provided but no "last_time" column is included. The default is 15.</p></dd>
  <dt><code>epoints</code></dt><dd><p>a positive integer specifying the number of discrete 
  time points at which to calculate the estimated longitudinal response for
  <code>extrapolate = TRUE</code>. These time points are evenly spaced between the 
  last known observation time for each individual and the extrapolation 
  distance specifed using either <code>edist</code> or <code>eprop</code>.
  The default is 15.</p></dd>
  <dt><code>eprop</code></dt><dd><p>a positive scalar between 0 and 1 specifying the 
  amount of time across which to extrapolate the longitudinal trajectory,
  represented as a proportion of the total observed follow up time for each
  individual. For example specifying <code>eprop = 0.2</code> means that for an
  individual for whom the latest of their measurement, event or censoring times
  was 10 years, their estimated longitudinal trajectory will be extrapolated 
  out to 12 years (i.e. 10 + (0.2 * 10)). The default value is 0.2.</p></dd>
  <dt><code>edist</code></dt><dd><p>a positive scalar specifying the amount of time 
  across which to extrapolate the longitudinal trajectory for each individual,
  represented in units of the time variable <code>time_var</code> (from fitting the
  model). This cannot be specified if <code>eprop</code> is specified.</p></dd> 

</dl></td>
    </tr>
    <tr>
      <th>last_time</th>
      <td><p>A scalar, character string, or <code>NULL</code>. This argument 
specifies the last known survival time for each individual when
conditional predictions are being obtained. If 
<code>newdataEvent</code> is provided and conditional survival predictions are being
obtained, then the <code>last_time</code> argument can be one of the following:
(i) a scalar, this will use the same last time for each individual in 
<code>newdataEvent</code>; (ii) a character string, naming a column in 
<code>newdataEvent</code> in which to look for the last time for each individual;
(iii) <code>NULL</code>, in which case the default is to use the time of the latest 
longitudinal observation in <code>newdataLong</code>. If <code>newdataEvent</code> is
<code>NULL</code> then the <code>last_time</code> argument cannot be specified 
directly; instead it will be set equal to the event or censoring time for
each individual in the dataset that was used to estimate the model. 
If standardised survival probabilities are requested (i.e. 
<code>standardise = TRUE</code>) then conditional survival probabilities are
not allowed and therefore the <code>last_time</code> argument is ignored.</p></td>
    </tr>
    <tr>
      <th>prob</th>
      <td><p>A scalar between 0 and 1 specifying the width to use for the 
uncertainty interval (sometimes called credible interval) for the predicted
mean response and the prediction interval for the predicted (raw) response. 
For example <code>prob = 0.95</code> (the default) means that the 2.5th and 97.5th  
percentiles will be provided. Only relevant when <code>return_matrix</code> is 
<code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>ids</th>
      <td><p>An optional vector specifying a subset of subject IDs for whom the 
predictions should be obtained. The default is to predict for all individuals
who were used in estimating the model or, if <code>newdata</code> is specified,
then all individuals contained in <code>newdata</code>.</p></td>
    </tr>
    <tr>
      <th>dynamic</th>
      <td><p>A logical that is only relevant if new data is provided
via the <code>newdata</code> argument. If 
<code>dynamic = TRUE</code>, then new group-specific parameters are drawn for 
the individuals in the new data, conditional on their longitudinal 
biomarker data contained in <code>newdata</code>. These group-specific
parameters are then used to generate individual-specific survival probabilities
for these individuals. These are often referred to as "dynamic predictions"
in the joint modelling context, because the predictions can be updated
each time additional longitudinal biomarker data is collected on the individual.
On the other hand, if <code>dynamic = FALSE</code> then the survival probabilities
will just be marginalised over the distribution of the group-specific
coefficients; this will mean that the predictions will incorporate all
uncertainty due to between-individual variation so there will likely be
very wide credible intervals on the predicted survival probabilities.</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>A scalar, specifying how much to multiply the asymptotic 
variance-covariance matrix for the random effects by, which is then
used as the "width" (ie. variance-covariance matrix) of the multivariate
Student-t proposal distribution in the Metropolis-Hastings algorithm. This
is only relevant when <code>newdataEvent</code> is supplied and 
<code>dynamic = TRUE</code>, in which case new random effects are simulated
for the individuals in the new data using the Metropolis-Hastings algorithm.</p></td>
    </tr>
    <tr>
      <th>draws</th>
      <td><p>An integer indicating the number of MCMC draws to return. 
The default is to set the number of draws equal to 200, or equal to the 
size of the posterior sample if that is less than 200.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>An optional <code><a href='https://rdrr.io/r/base/Random.html'>seed</a></code> to use.</p></td>
    </tr>
    <tr>
      <th>return_matrix</th>
      <td><p>A logical. If <code>TRUE</code> then a <code>draws</code> by 
<code><a href='https://rdrr.io/r/base/nrow.html'>nrow(newdata)</a></code> matrix is returned which contains all the actual
simulations or draws from the posterior predictive distribution. Otherwise
if <code>return_matrix</code> is set to <code>FALSE</code> (the default) then a 
data frame is returned, as described in the <strong>Value</strong> section below.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to <code><a href='posterior_predict.stanreg.html'>posterior_predict</a></code>, for
example <code>draws</code>, <code>re.form</code>, <code>seed</code>, etc.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>When <code>return_matrix = FALSE</code>, a data frame 
  of class <code>predict.stanjm</code>. The data frame includes a column for the median 
  of the posterior predictions of the mean longitudinal response (<code>yfit</code>),
  a column for each of the lower and upper limits of the uncertainty interval
  corresponding to the posterior predictions of the mean longitudinal response 
  (<code>ci_lb</code> and <code>ci_ub</code>), and a column for each of the lower and upper
  limits of the prediction interval corresponding to the posterior predictions
  of the (raw) longitudinal response. The data frame also includes columns for
  the subject ID variable, and each of the predictor variables. The returned
  object also includes a number of attributes.</p>  
<p>When <code>return_matrix = TRUE</code>, the returned object is the same as that 
  described for <code><a href='posterior_predict.stanreg.html'>posterior_predict</a></code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>posterior_traj</code> function acts as a wrapper to the 
<code><a href='posterior_predict.stanreg.html'>posterior_predict</a></code> function, but allows predictions to be 
easily generated at time points that are interpolated and/or extrapolated 
between time zero (baseline) and the last known survival time for the 
individual, thereby providing predictions that correspond to a smooth estimate
of the longitudinal trajectory (useful for the plotting via the associated
<code><a href='plot.predict.stanjm.html'>plot.predict.stanjm</a></code> method). In addition it returns a data 
frame by default, whereas the <code><a href='posterior_predict.stanreg.html'>posterior_predict</a></code> function 
returns a matrix; see the <strong>Value</strong> section below for details. Also,
<code>posterior_traj</code> allows predictions to only be generated for a subset
of individuals, via the <code>ids</code> argument.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot.predict.stanjm.html'>plot.predict.stanjm</a></code>, <code><a href='posterior_predict.stanreg.html'>posterior_predict</a></code>,
  <code><a href='posterior_survfit.html'>posterior_survfit</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
  <span class='co'># Run example model if not already loaded</span>
  <span class='kw'>if</span> (!<span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span>(<span class='st'>"example_jm"</span>)) <span class='fu'><a href='https://rdrr.io/r/utils/example.html'>example</a></span>(<span class='no'>example_jm</span>)

  <span class='co'># Obtain subject-specific predictions for all individuals </span>
  <span class='co'># in the estimation dataset</span>
  <span class='no'>pt1</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>, <span class='kw'>interpolate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>extrapolate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>pt1</span>)</div><div class='output co'>#&gt;   id      year       yfit       ci_lb     ci_ub      pi_lb    pi_ub
#&gt; 1  1 0.0000000 2.69984909  2.25764936 3.2239869  1.6413644 3.577369
#&gt; 2  1 0.5256674 2.79254601  2.34119466 3.3084102  1.8686028 3.786467
#&gt; 3  2 0.0000000 0.06099148 -0.28755884 0.3632144 -0.7153253 1.142746
#&gt; 4  2 0.4982888 0.14683570 -0.19678502 0.4418192 -0.6692718 1.090876
#&gt; 5  2 0.9993155 0.23240127 -0.10551244 0.5220164 -0.8086935 0.891891
#&gt; 6  2 2.1026694 0.41666914  0.09548675 0.7127605 -0.4392688 1.196561</div><div class='input'>
  <span class='co'># Obtain subject-specific predictions only for a few selected individuals</span>
  <span class='no'>pt2</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>, <span class='kw'>ids</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>8</span>))

  <span class='co'># If we wanted to obtain subject-specific predictions in order to plot the </span>
  <span class='co'># longitudinal trajectories, then we might want to ensure a full trajectory </span>
  <span class='co'># is obtained by interpolating and extrapolating time. We can then use the </span>
  <span class='co'># generic plot function to plot the subject-specific predicted trajectories</span>
  <span class='co'># for the first three individuals. Interpolation and extrapolation is </span>
  <span class='co'># carried out by default.</span>
  <span class='no'>pt3</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>)
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>pt3</span>) <span class='co'># predictions at additional time points compared with pt1 </span></div><div class='output co'>#&gt;   id year        yfit      ci_lb      ci_ub      pi_lb       pi_ub
#&gt; 1  1    0  2.69984909  2.2576494  3.2239869  1.8820139  4.15414861
#&gt; 2  2    0  0.06099148 -0.2875588  0.3632144 -0.6504792  0.77562794
#&gt; 3  3    0  0.22635897 -0.1014481  0.6277125 -0.6215849  0.86623579
#&gt; 4  4    0  0.65360972  0.3630433  1.0321208 -0.2365076  1.43172407
#&gt; 5  5    0  1.14671848  0.8692571  1.4856038  0.4108954  1.81162914
#&gt; 6  6    0 -0.73281998 -0.9630179 -0.3803159 -1.6285571 -0.03093085</div><div class='input'>  <span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>pt3</span>, <span class='kw'>ids</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>)</div><div class='output co'>#&gt; <span class='message'>`geom_smooth()` using formula 'y ~ x'</span></div><div class='output co'>#&gt; <span class='message'>`geom_smooth()` using formula 'y ~ x'</span></div><div class='output co'>#&gt; <span class='message'>`geom_smooth()` using formula 'y ~ x'</span></div><div class='img'><img src='posterior_traj-1.png' alt='' width='700' height='433' /></div><div class='input'>
  <span class='co'># If we wanted to extrapolate further in time, but decrease the number of </span>
  <span class='co'># discrete time points at which we obtain predictions for each individual, </span>
  <span class='co'># then we could specify a named list in the 'control' argument</span>
  <span class='no'>pt4</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>, <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>ipoints</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>epoints</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>eprop</span> <span class='kw'>=</span> <span class='fl'>0.5</span>))

  <span class='co'># If we have prediction data for a new individual, and we want to</span>
  <span class='co'># estimate the longitudinal trajectory for that individual conditional</span>
  <span class='co'># on this new data (perhaps extrapolating forward from our last</span>
  <span class='co'># longitudinal measurement) then we can do that. It requires drawing</span>
  <span class='co'># new individual-specific parameters, based on the full likelihood,</span>
  <span class='co'># so we must supply new data for both the longitudinal and event </span>
  <span class='co'># submodels. These are sometimes known as dynamic predictions.</span>
  <span class='no'>ndL</span> <span class='kw'>&lt;-</span> <span class='no'>pbcLong</span>[<span class='no'>pbcLong</span>$<span class='no'>id</span> <span class='kw'>==</span> <span class='fl'>8</span>, , <span class='kw'>drop</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>]
  <span class='no'>ndE</span> <span class='kw'>&lt;-</span> <span class='no'>pbcSurv</span>[<span class='no'>pbcSurv</span>$<span class='no'>id</span> <span class='kw'>==</span> <span class='fl'>8</span>, , <span class='kw'>drop</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>]
  <span class='no'>ndL</span>$<span class='no'>id</span> <span class='kw'>&lt;-</span> <span class='st'>"new_subject"</span> <span class='co'># new id can't match one used in training data</span>
  <span class='no'>ndE</span>$<span class='no'>id</span> <span class='kw'>&lt;-</span> <span class='st'>"new_subject"</span>
  <span class='no'>pt5</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>,
                        <span class='kw'>newdataLong</span> <span class='kw'>=</span> <span class='no'>ndL</span>,
                        <span class='kw'>newdataEvent</span> <span class='kw'>=</span> <span class='no'>ndE</span>)</div><div class='output co'>#&gt; Drawing new random effects for 1 individuals. Monitoring progress:
#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</div><div class='input'>
  <span class='co'># By default it is assumed that the last known survival time for </span>
  <span class='co'># the individual is the time of their last biomarker measurement,</span>
  <span class='co'># but if we know they survived to some later time then we can</span>
  <span class='co'># condition on that information using the last_time argument</span>
  <span class='no'>pt6</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>,
                        <span class='kw'>newdataLong</span> <span class='kw'>=</span> <span class='no'>ndL</span>,
                        <span class='kw'>newdataEvent</span> <span class='kw'>=</span> <span class='no'>ndE</span>,
                        <span class='kw'>last_time</span> <span class='kw'>=</span> <span class='st'>"futimeYears"</span>)</div><div class='output co'>#&gt; Drawing new random effects for 1 individuals. Monitoring progress:
#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</div><div class='input'>
  <span class='co'># Alternatively we may want to estimate the marginal longitudinal</span>
  <span class='co'># trajectory for a given set of covariates. To do this, we can pass</span>
  <span class='co'># the desired covariate values in a new data frame (however the only</span>
  <span class='co'># covariate in our fitted model was the time variable, year). To make sure  </span>
  <span class='co'># that we marginalise over the random effects, we need to specify an ID value</span>
  <span class='co'># which does not correspond to any of the individuals who were used in the</span>
  <span class='co'># model estimation and specify the argument dynamic=FALSE.</span>
  <span class='co'># The marginal prediction is obtained by generating subject-specific </span>
  <span class='co'># predictions using a series of random draws from the random </span>
  <span class='co'># effects distribution, and then integrating (ie, averaging) over these. </span>
  <span class='co'># Our marginal prediction will therefore capture the between-individual </span>
  <span class='co'># variation associated with the random effects.</span>
  <span class='no'>nd</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='kw'>id</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='st'>"new1"</span>, <span class='fl'>11</span>), <span class='kw'>year</span> <span class='kw'>=</span> (<span class='fl'>0</span>:<span class='fl'>10</span> / <span class='fl'>2</span>))
  <span class='no'>pt7</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>, <span class='kw'>newdataLong</span> <span class='kw'>=</span> <span class='no'>nd</span>, <span class='kw'>dynamic</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>pt7</span>)  <span class='co'># note the greater width of the uncertainty interval compared </span></div><div class='output co'>#&gt;     id      year      yfit     ci_lb    ci_ub     pi_lb    pi_ub
#&gt; 1 new1 0.0000000 0.8383967 -2.779474 2.740931 -2.771958 2.807810
#&gt; 2 new1 0.3571429 0.8964855 -2.722729 2.800614 -2.934628 3.159185
#&gt; 3 new1 0.7142857 0.9492078 -2.665984 2.860296 -2.875908 2.856379
#&gt; 4 new1 1.0714286 1.0019300 -2.609239 2.919979 -2.905819 3.159848
#&gt; 5 new1 1.4285714 1.0574264 -2.552494 2.979661 -2.384959 3.226213
#&gt; 6 new1 1.7857143 1.1183328 -2.495749 3.039344 -2.552383 3.387019</div><div class='input'>             <span class='co'># with the subject-specific predictions in pt1, pt2, etc</span>

  <span class='co'># Alternatively, we could have estimated the "marginal" trajectory by </span>
  <span class='co'># ignoring the random effects (ie, assuming the random effects were set </span>
  <span class='co'># to zero). This will generate a predicted longitudinal trajectory only</span>
  <span class='co'># based on the fixed effect component of the model. In essence, for a </span>
  <span class='co'># linear mixed effects model (ie, a model that uses an identity link </span>
  <span class='co'># function), we should obtain a similar point estimate ("yfit") to the</span>
  <span class='co'># estimates obtained in pt5 (since the mean of the estimated random effects</span>
  <span class='co'># distribution will be approximately 0). However, it is important to note that</span>
  <span class='co'># the uncertainty interval will be much more narrow, since it completely</span>
  <span class='co'># ignores the between-individual variability captured by the random effects.</span>
  <span class='co'># Further, if the model uses a non-identity link function, then the point</span>
  <span class='co'># estimate ("yfit") obtained only using the fixed effect component of the</span>
  <span class='co'># model will actually provide a biased estimate of the marginal prediction.</span>
  <span class='co'># Nonetheless, to demonstrate how we can obtain the predictions only using </span>
  <span class='co'># the fixed effect component of the model, we simply specify 're.form = NA'. </span>
  <span class='co'># (We will use the same covariate values as used in the prediction for </span>
  <span class='co'># example for pt5).</span>
  <span class='no'>pt8</span> <span class='kw'>&lt;-</span> <span class='fu'>posterior_traj</span>(<span class='no'>example_jm</span>, <span class='kw'>newdataLong</span> <span class='kw'>=</span> <span class='no'>nd</span>, <span class='kw'>dynamic</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
                        <span class='kw'>re.form</span> <span class='kw'>=</span> <span class='fl'>NA</span>)
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>pt8</span>)  <span class='co'># note the much narrower ci, compared with pt5</span></div><div class='output co'>#&gt;     id      year      yfit     ci_lb    ci_ub       pi_lb    pi_ub
#&gt; 1 new1 0.0000000 0.6866444 0.2654333 1.123719 -0.27232294 1.695580
#&gt; 2 new1 0.3571429 0.7493349 0.3297991 1.182328 -0.20333442 1.858451
#&gt; 3 new1 0.7142857 0.8098669 0.3941648 1.239708 -0.29720147 1.479493
#&gt; 4 new1 1.0714286 0.8705245 0.4585306 1.297089 -0.32133975 1.528451
#&gt; 5 new1 1.4285714 0.9327557 0.5228963 1.355529 -0.16996192 1.859970
#&gt; 6 new1 1.7857143 0.9964271 0.5872620 1.418941 -0.08560543 1.826824</div><div class='input'># }

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


