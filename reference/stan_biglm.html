<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bayesian regularized linear but big models via Stan — stan_biglm • rstanarm</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Bayesian regularized linear but big models via Stan — stan_biglm" />

<meta property="og:description" content="
This is the same model as with stan_lm but it utilizes the
output from biglm in the biglm package in order to
proceed when the data is too large to fit in memory." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanarm</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.17.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../dev-notes/index.html">Develop</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian regularized linear but big models via Stan</h1>
    
    </div>

    
    <p><img src='figures/stanlogo.png' width="25px" alt="http://mc-stan.org/about/logo/" />
This is the same model as with <code><a href='stan_lm.html'>stan_lm</a></code> but it utilizes the
output from <code>biglm</code> in the <span class="pkg">biglm</span> package in order to
proceed when the data is too large to fit in memory.</p>
    

    <pre class="usage"><span class='fu'>stan_biglm</span>(<span class='no'>biglm</span>, <span class='no'>xbar</span>, <span class='no'>ybar</span>, <span class='no'>s_y</span>, <span class='no'>...</span>,
  <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>R2</a></span>(<span class='fu'>stop</span>(<span class='st'>"'location' must be specified"</span>)), <span class='kw'>prior_intercept</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prior_PD</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"sampling"</span>, <span class='st'>"meanfield"</span>, <span class='st'>"fullrank"</span>),
  <span class='kw'>adapt_delta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>stan_biglm.fit</span>(<span class='no'>b</span>, <span class='no'>R</span>, <span class='no'>SSR</span>, <span class='no'>N</span>, <span class='no'>xbar</span>, <span class='no'>ybar</span>, <span class='no'>s_y</span>, <span class='kw'>has_intercept</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>,
  <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>R2</a></span>(<span class='fu'>stop</span>(<span class='st'>"'location' must be specified"</span>)), <span class='kw'>prior_intercept</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prior_PD</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>algorithm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"sampling"</span>, <span class='st'>"meanfield"</span>, <span class='st'>"fullrank"</span>),
  <span class='kw'>adapt_delta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>biglm</th>
      <td><p>The list output by <code>biglm</code> in the <span class="pkg">biglm</span>
package.</p></td>
    </tr>
    <tr>
      <th>xbar</th>
      <td><p>A numeric vector of column means in the implicit design matrix 
excluding the intercept for the observations included in the model.</p></td>
    </tr>
    <tr>
      <th>ybar</th>
      <td><p>A numeric scalar indicating the mean of the outcome for the
observations included in the model.</p></td>
    </tr>
    <tr>
      <th>s_y</th>
      <td><p>A numeric scalar indicating the unbiased sample standard deviation
of the outcome for the observations included in the model.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to the function in the <span class="pkg">rstan</span> 
package (<code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>sampling</a></code>, <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-vb'>vb</a></code>, or 
<code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-optimizing'>optimizing</a></code>), corresponding to the estimation method 
named by <code>algorithm</code>. For example, if <code>algorithm</code> is
<code>"sampling"</code> it is possibly to specify <code>iter</code>, <code>chains</code>,
<code>cores</code>, <code>refresh</code>, etc.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>Must be a call to <code><a href='priors.html'>R2</a></code> with its <code>location</code>
argument specified or <code>NULL</code>, which would indicate a standard uniform
prior for the \(R^2\).</p></td>
    </tr>
    <tr>
      <th>prior_intercept</th>
      <td><p>Either <code>NULL</code> (the default) or a call to 
<code><a href='priors.html'>normal</a></code>. If a <code><a href='priors.html'>normal</a></code> prior is specified without
a <code>scale</code>, then the standard deviation is taken to be the marginal
standard deviation of the outcome divided by the square root of the sample
size, which is legitimate because the marginal standard deviation of the
outcome is a primitive parameter being estimated.</p></td>
    </tr>
    <tr>
      <th>prior_PD</th>
      <td><p>A logical scalar (defaulting to <code>FALSE</code>) indicating
whether to draw from the prior predictive distribution instead of
conditioning on the outcome.</p></td>
    </tr>
    <tr>
      <th>algorithm</th>
      <td><p>A string (possibly abbreviated) indicating the 
estimation approach to use. Can be <code>"sampling"</code> for MCMC (the
default), <code>"optimizing"</code> for optimization, <code>"meanfield"</code> for
variational inference with independent normal distributions, or
<code>"fullrank"</code> for variational inference with a multivariate normal
distribution. See <code><a href='rstanarm-package.html'>rstanarm-package</a></code> for more details on the
estimation algorithms. NOTE: not all fitting functions support all four
algorithms.</p></td>
    </tr>
    <tr>
      <th>adapt_delta</th>
      <td><p>Only relevant if <code>algorithm="sampling"</code>. See 
the <a href='adapt_delta.html'>adapt_delta</a> help page for details.</p></td>
    </tr>
    <tr>
      <th>b</th>
      <td><p>A numeric vector of OLS coefficients, excluding the intercept</p></td>
    </tr>
    <tr>
      <th>R</th>
      <td><p>A square upper-triangular matrix from the QR decomposition of the 
design matrix, excluding the intercept</p></td>
    </tr>
    <tr>
      <th>SSR</th>
      <td><p>A numeric scalar indicating the sum-of-squared residuals for OLS</p></td>
    </tr>
    <tr>
      <th>N</th>
      <td><p>A integer scalar indicating the number of included observations</p></td>
    </tr>
    <tr>
      <th>has_intercept</th>
      <td><p>A logical scalar indicating whether to add an intercept 
to the model when estimating it.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The output of both <code>stan_biglm</code> and <code>stan_biglm.fit</code> is an
  object of <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanfit-class'>stanfit-class</a></code> rather than
  <code><a href='stanreg-objects.html'>stanreg-objects</a></code>, which is more limited and less convenient
  but necessitated by the fact that <code>stan_biglm</code> does not bring the full
  design matrix into memory. Without the full design matrix,some of the
  elements of a <code><a href='stanreg-objects.html'>stanreg-objects</a></code> object cannot be calculated,
  such as residuals. Thus, the functions in the <span class="pkg">rstanarm</span> package that
  input <code><a href='stanreg-objects.html'>stanreg-objects</a></code>, such as 
  <code><a href='posterior_predict.stanreg.html'>posterior_predict</a></code> cannot be used.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>stan_biglm</code> function is intended to be used in the same 
  circumstances as the <code>biglm</code> function in the <span class="pkg">biglm</span>
  package but with an informative prior on the \(R^2\) of the regression. 
  Like <code>biglm</code>, the memory required to estimate the model 
  depends largely on the number of predictors rather than the number of 
  observations. However, <code>stan_biglm</code> and <code>stan_biglm.fit</code> have 
  additional required arguments that are not necessary in 
  <code>biglm</code>, namely <code>xbar</code>, <code>ybar</code>, and <code>s_y</code>.
  If any observations have any missing values on any of the predictors or the 
  outcome, such observations do not contribute to these statistics.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># create inputs</span>
<span class='no'>ols</span> <span class='kw'>&lt;-</span> <span class='fu'>lm</span>(<span class='no'>mpg</span> ~ <span class='no'>wt</span> + <span class='no'>qsec</span> + <span class='no'>am</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>mtcars</span>, <span class='co'># all row are complete so ...</span>
          <span class='kw'>na.action</span> <span class='kw'>=</span> <span class='no'>na.exclude</span>)              <span class='co'># not necessary in this case</span>
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>coef</span>(<span class='no'>ols</span>)[-<span class='fl'>1</span>]
<span class='no'>R</span> <span class='kw'>&lt;-</span> <span class='fu'>qr.R</span>(<span class='no'>ols</span>$<span class='no'>qr</span>)[-<span class='fl'>1</span>,-<span class='fl'>1</span>]
<span class='no'>SSR</span> <span class='kw'>&lt;-</span> <span class='fu'>crossprod</span>(<span class='no'>ols</span>$<span class='no'>residuals</span>)[<span class='fl'>1</span>]
<span class='no'>not_NA</span> <span class='kw'>&lt;-</span> !<span class='fu'>is.na</span>(<span class='fu'>fitted</span>(<span class='no'>ols</span>))
<span class='no'>N</span> <span class='kw'>&lt;-</span> <span class='fu'>sum</span>(<span class='no'>not_NA</span>)
<span class='no'>xbar</span> <span class='kw'>&lt;-</span> <span class='fu'>colMeans</span>(<span class='no'>mtcars</span>[<span class='no'>not_NA</span>,<span class='fu'>c</span>(<span class='st'>"wt"</span>, <span class='st'>"qsec"</span>, <span class='st'>"am"</span>)])
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>mtcars</span>$<span class='no'>mpg</span>[<span class='no'>not_NA</span>]
<span class='no'>ybar</span> <span class='kw'>&lt;-</span> <span class='fu'>mean</span>(<span class='no'>y</span>)
<span class='no'>s_y</span> <span class='kw'>&lt;-</span> <span class='fu'>sd</span>(<span class='no'>y</span>)
<span class='no'>post</span> <span class='kw'>&lt;-</span> <span class='fu'>stan_biglm.fit</span>(<span class='no'>b</span>, <span class='no'>R</span>, <span class='no'>SSR</span>, <span class='no'>N</span>, <span class='no'>xbar</span>, <span class='no'>ybar</span>, <span class='no'>s_y</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='priors.html'>R2</a></span>(<span class='fl'>.75</span>),
                       <span class='co'># the next line is only to make the example go fast</span>
                       <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>500</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>12345</span>)</div><div class='output co'>#&gt; 
#&gt; SAMPLING FOR MODEL 'lm' NOW (CHAIN 1).
#&gt; 
#&gt; Gradient evaluation took 2.7e-05 seconds
#&gt; 1000 transitions using 10 leapfrog steps per transition would take 0.27 seconds.
#&gt; Adjust your expectations accordingly!
#&gt; 
#&gt; 
#&gt; Iteration:   1 / 500 [  0%]  (Warmup)
#&gt; Iteration:  50 / 500 [ 10%]  (Warmup)
#&gt; Iteration: 100 / 500 [ 20%]  (Warmup)
#&gt; Iteration: 150 / 500 [ 30%]  (Warmup)
#&gt; Iteration: 200 / 500 [ 40%]  (Warmup)
#&gt; Iteration: 250 / 500 [ 50%]  (Warmup)
#&gt; Iteration: 251 / 500 [ 50%]  (Sampling)
#&gt; Iteration: 300 / 500 [ 60%]  (Sampling)
#&gt; Iteration: 350 / 500 [ 70%]  (Sampling)
#&gt; Iteration: 400 / 500 [ 80%]  (Sampling)
#&gt; Iteration: 450 / 500 [ 90%]  (Sampling)
#&gt; Iteration: 500 / 500 [100%]  (Sampling)
#&gt; 
#&gt;  Elapsed Time: 1.26895 seconds (Warm-up)
#&gt;                0.663211 seconds (Sampling)
#&gt;                1.93216 seconds (Total)
#&gt; </div><div class='output co'>#&gt; <span class='warning'>Warning: There were 1 divergent transitions after warmup. Increasing adapt_delta above 0.99 may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Examine the pairs() plot to diagnose sampling problems</span></div><div class='input'><span class='fu'>cbind</span>(<span class='kw'>lm</span> <span class='kw'>=</span> <span class='no'>b</span>, <span class='kw'>stan_lm</span> <span class='kw'>=</span> <span class='kw pkg'>rstan</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/rstan/topics/stanfit-class'>get_posterior_mean</a></span>(<span class='no'>post</span>)[<span class='fl'>13</span>:<span class='fl'>15</span>,]) <span class='co'># shrunk</span></div><div class='output co'>#&gt;             lm   stan_lm
#&gt; wt   -3.916504 -3.819190
#&gt; qsec  1.225886  1.213892
#&gt; am    2.935837  2.788297</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

