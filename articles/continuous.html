<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Generalized Linear Models for Continuous Data with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Generalized Linear Models for Continuous Data with rstanarm">
<meta property="og:description" content="rstanarm">
<meta property="og:image" content="https://mc-stan.org/rstanarm/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanarm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.21.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../dev-notes/index.html">Develop</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior">posterior</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="continuous_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating Generalized Linear Models for Continuous Data with rstanarm</h1>
                        <h4 class="author">Jonah Gabry and Ben Goodrich</h4>
            
            <h4 class="date">2020-07-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/rstanarm/blob/master/vignettes/continuous.Rmd"><code>vignettes/continuous.Rmd</code></a></small>
      <div class="hidden name"><code>continuous.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_glm: GLMs for Continuous Data}
-->
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">bayesplot</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="kw pkg">bayesplot</span><span class="kw ns">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html">theme_default</a></span>())</pre></body></html></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette explains how to estimate linear and generalized linear models (GLMs) for continuous response variables using the <code>stan_glm</code> function in the <strong>rstanarm</strong> package. For GLMs for discrete outcomes see the vignettes for <a href="binomial.html">binary/binomial</a> and <a href="count.html">count</a> outcomes.</p>
<p>The four steps of a Bayesian analysis are</p>
<ol style="list-style-type: decimal">
<li>Specify a joint distribution for the outcome(s) and all the unknowns, which typically takes the form of a marginal prior distribution for the unknowns multiplied by a likelihood for the outcome(s) conditional on the unknowns. This joint distribution is proportional to a posterior distribution of the unknowns conditional on the observed data</li>
<li>Draw from posterior distribution using Markov Chain Monte Carlo (MCMC).</li>
<li>Evaluate how well the model fits the data and possibly revise the model.</li>
<li>Draw from the posterior predictive distribution of the outcome(s) given interesting values of the predictors in order to visualize how a manipulation of a predictor affects (a function of) the outcome(s).</li>
</ol>
<p>This vignette primarily focuses on Steps 1 and 2 when the likelihood is the product of conditionally independent continuous distributions. Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong> Package”</a>, although this vignette does also give a few examples of model checking and generating predictions.</p>
</div>
<div id="likelihood" class="section level1">
<h1 class="hasAnchor">
<a href="#likelihood" class="anchor"></a>Likelihood</h1>
<p>In the simplest case a GLM for a continuous outcome is simply a linear model and the likelihood for one observation is a conditionally normal PDF <span class="math display">\[\frac{1}{\sigma \sqrt{2 \pi}} e^{-\frac{1}{2}
\left(\frac{y - \mu}{\sigma}\right)^2},\]</span> where <span class="math inline">\(\mu = \alpha + \mathbf{x}^\top \boldsymbol{\beta}\)</span> is a linear predictor and <span class="math inline">\(\sigma\)</span> is the standard deviation of the error in predicting the outcome, <span class="math inline">\(y\)</span>.</p>
<p>More generally, a linear predictor <span class="math inline">\(\eta = \alpha + \mathbf{x}^\top \boldsymbol{\beta}\)</span> can be related to the conditional mean of the outcome via a link function <span class="math inline">\(g\)</span> that serves as a map between the range of values on which the outcome is defined and the space on which the linear predictor is defined. For the linear model described above no transformation is needed and so the link function is taken to be the identity function. However, there are cases in which a link function is used for Gaussian models; the log link, for example, can be used to log transform the (conditional) expected value of the outcome when it is constrained to be positive.</p>
<p>Like the <code>glm</code> function, the <code>stan_glm</code> function uses R’s family objects. The family objects for continuous outcomes compatible with <code>stan_glm</code> are the <code>gaussian</code>, <code>Gamma</code>, and <code>inverse.gaussian</code> distributions. All of the link functions provided by these family objects are also compatible with <code>stan_glm</code>. For example, for a Gamma GLM, where we assume that observations are conditionally independent Gamma random variables, common link functions are the log and inverse links.</p>
<p>Regardless of the distribution and link function, the likelihood for the entire sample is the product of the likelihood contributions of the individual observations.</p>
</div>
<div id="priors" class="section level1">
<h1 class="hasAnchor">
<a href="#priors" class="anchor"></a>Priors</h1>
<p>A full Bayesian analysis requires specifying prior distributions <span class="math inline">\(f(\alpha)\)</span> and <span class="math inline">\(f(\boldsymbol{\beta})\)</span> for the intercept and vector of regression coefficients. When using <code>stan_glm</code>, these distributions can be set using the <code>prior_intercept</code> and <code>prior</code> arguments. The <code>stan_glm</code> function supports a variety of prior distributions, which are explained in the <strong>rstanarm</strong> documentation (<code><a href="../reference/priors.html">help(priors, package = 'rstanarm')</a></code>).</p>
<p>As an example, suppose we have <span class="math inline">\(K\)</span> predictors and believe — prior to seeing the data — that <span class="math inline">\(\alpha, \beta_1, \dots, \beta_K\)</span> are as likely to be positive as they are to be negative, but are highly unlikely to be far from zero. These beliefs can be represented by normal distributions with mean zero and a small scale (standard deviation). To give <span class="math inline">\(\alpha\)</span> and each of the <span class="math inline">\(\beta\)</span>s this prior (with a scale of 1, say), in the call to <code>stan_glm</code> we would include the arguments <code>prior_intercept = normal(0,1)</code> and <code>prior = normal(0,1)</code>.</p>
<p>If, on the other hand, we have less a priori confidence that the parameters will be close to zero then we could use a larger scale for the normal distribution and/or a distribution with heavier tails than the normal like the Student t distribution. <strong>Step 1</strong> in the “How to Use the <strong>rstanarm</strong> Package” vignette discusses one such example.</p>
</div>
<div id="posterior" class="section level1">
<h1 class="hasAnchor">
<a href="#posterior" class="anchor"></a>Posterior</h1>
<p>With independent prior distributions, the joint posterior distribution for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> is proportional to the product of the priors and the <span class="math inline">\(N\)</span> likelihood contributions:</p>
<p><span class="math display">\[f\left(\boldsymbol{\beta} | \mathbf{y},\mathbf{X}\right) \propto
  f\left(\alpha\right) \times \prod_{k=1}^K f\left(\beta_k\right) \times
  \prod_{i=1}^N {f(y_i|\eta_i)},\]</span></p>
<p>where <span class="math inline">\(\mathbf{X}\)</span> is the matrix of predictors and <span class="math inline">\(\eta\)</span> the linear predictor. This is the posterior distribution that <code>stan_glm</code> will draw from when using MCMC.</p>
</div>
<div id="linear-regression-example" class="section level1">
<h1 class="hasAnchor">
<a href="#linear-regression-example" class="anchor"></a>Linear Regression Example</h1>
<p>The <code>stan_lm</code> function, which has its own <a href="lm.html">vignette</a>, fits regularized linear models using a novel means of specifying priors for the regression coefficients. Here we focus using the <code>stan_glm</code> function, which can be used to estimate linear models with independent priors on the regression coefficients.</p>
<p>To illustrate the usage of <code>stan_glm</code> and some of the post-processing functions in the <strong>rstanarm</strong> package we’ll use a simple example from Chapter 3 of <a href="http://www.stat.columbia.edu/~gelman/arm/">Gelman and Hill (2007)</a>:</p>
<blockquote>
<p>We shall fit a series of regressions predicting cognitive test scores of three- and four-year-old children given characteristics of their mothers, using data from a survey of adult American women and their children (a subsample from the National Longitudinal Survey of Youth).</p>
</blockquote>
<p>Using two predictors – a binary indicator for whether the mother has a high-school degree (<code>mom_hs</code>) and the mother’s score on an IQ test (<code>mom_iq</code>) – we will fit four contending models. The first two models will each use just one of the predictors, the third will use both, and the fourth will also include a term for the interaction of the two predictors.</p>
<p>For these models we’ll use the default weakly informative priors for <code>stan_glm</code>, which are currently set to <code><a href="../reference/priors.html">normal(0,10)</a></code> for the intercept and <code><a href="../reference/priors.html">normal(0,5)</a></code> for the other regression coefficients. For an overview of the many other available prior distributions see <code>help("prior", package = "rstanarm")</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rstanarm</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">kidiq</span>)
<span class="no">post1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_glm.html">stan_glm</a></span>(<span class="no">kid_score</span> ~ <span class="no">mom_hs</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">kidiq</span>,
                  <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span>(<span class="kw">link</span> <span class="kw">=</span> <span class="st">"identity"</span>),
                  <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">12345</span>)
<span class="no">post2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">post1</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">.</span> ~ <span class="no">mom_iq</span>)
<span class="no">post3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">post1</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">.</span> ~ <span class="no">mom_hs</span> + <span class="no">mom_iq</span>)
(<span class="no">post4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="no">post1</span>, <span class="kw">formula</span> <span class="kw">=</span> <span class="no">.</span> ~ <span class="no">mom_hs</span> * <span class="no">mom_iq</span>))</pre></body></html></div>
<pre><code>stan_glm
 family:       gaussian [identity]
 formula:      kid_score ~ mom_hs + mom_iq + mom_hs:mom_iq
 observations: 434
 predictors:   4
------
              Median MAD_SD
(Intercept)   -9.8   13.4  
mom_hs        49.3   15.0  
mom_iq         1.0    0.1  
mom_hs:mom_iq -0.5    0.2  

Auxiliary parameter(s):
      Median MAD_SD
sigma 18.0    0.6  

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Following Gelman and Hill’s example, we make some plots overlaying the estimated regression lines on the data.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">base</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">kidiq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">mom_hs</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">kid_score</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">position</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span>(<span class="kw">height</span> <span class="kw">=</span> <span class="fl">0.05</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No HS"</span>, <span class="st">"HS"</span>))

<span class="no">base</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post1</span>)[<span class="fl">1</span>], <span class="kw">slope</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post1</span>)[<span class="fl">2</span>],
                   <span class="kw">color</span> <span class="kw">=</span> <span class="st">"skyblue4"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot1a-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>There several ways we could add the uncertainty in our estimates to the plot. One way is to also plot the estimated regression line at each draw from the posterior distribution. To do this we can extract the posterior draws from the fitted model object using the <code>as.matrix</code> or <code>as.data.frame</code> methods:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">draws</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">post1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">draws</span>)[<span class="fl">1</span>:<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>)

<span class="no">base</span> +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="no">a</span>, <span class="kw">slope</span> <span class="kw">=</span> <span class="no">b</span>),
              <span class="kw">color</span> <span class="kw">=</span> <span class="st">"skyblue"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.25</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post1</span>)[<span class="fl">1</span>], <span class="kw">slope</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post1</span>)[<span class="fl">2</span>],
              <span class="kw">color</span> <span class="kw">=</span> <span class="st">"skyblue4"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot1b-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>For the second model we can make the same plot but the x-axis will show the continuous predictor <code>mom_iq</code>:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">draws</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">post2</span>))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">draws</span>)[<span class="fl">1</span>:<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">kidiq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">mom_iq</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">kid_score</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="no">a</span>, <span class="kw">slope</span> <span class="kw">=</span> <span class="no">b</span>),
              <span class="kw">color</span> <span class="kw">=</span> <span class="st">"skyblue"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.25</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post2</span>)[<span class="fl">1</span>], <span class="kw">slope</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post2</span>)[<span class="fl">2</span>],
              <span class="kw">color</span> <span class="kw">=</span> <span class="st">"skyblue4"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot2-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>For the third and fourth models, each of which uses both predictors, we can plot the continuous <code>mom_iq</code> on the x-axis and use color to indicate which points correspond to the different subpopulations defined by <code>mom_hs</code>. We also now plot two regression lines, one for each subpopulation:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">reg0</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">ests</span>) <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="no">x</span>) <span class="kw">%*%</span> <span class="no">ests</span>
<span class="no">reg1</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">ests</span>) <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="no">x</span>) <span class="kw">%*%</span> <span class="no">ests</span>

<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">ests</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post3</span>))
<span class="no">kidiq</span>$<span class="no">clr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">kidiq</span>$<span class="no">mom_hs</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No HS"</span>, <span class="st">"HS"</span>))
<span class="no">lgnd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="kw">NULL</span>)
<span class="no">base2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">kidiq</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">mom_iq</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span>(<span class="no">clr</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="st">"HS"</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">kid_score</span>), <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">stroke</span> <span class="kw">=</span> <span class="fl">.2</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">lgnd</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">lgnd</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"right"</span>)
<span class="no">base2</span> +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span> <span class="kw">=</span> <span class="no">reg0</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="no">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"No HS"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.5</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span> <span class="kw">=</span> <span class="no">reg1</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="no">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"HS"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.5</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot3-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">reg0</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">ests</span>) <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="no">x</span>, <span class="fl">0</span> * <span class="no">x</span>) <span class="kw">%*%</span> <span class="no">ests</span>
<span class="no">reg1</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">ests</span>) <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="no">x</span>, <span class="fl">1</span> * <span class="no">x</span>) <span class="kw">%*%</span> <span class="no">ests</span>
<span class="no">args</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">ests</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">post4</span>))
<span class="no">base2</span> +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span> <span class="kw">=</span> <span class="no">reg0</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="no">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"No HS"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.5</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span> <span class="kw">=</span> <span class="no">reg1</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="no">args</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"HS"</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.5</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot4-1.png" width="60%" style="display: block; margin: auto;"></p>
<div id="model-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#model-comparison" class="anchor"></a>Model comparison</h2>
<p>One way we can compare the four contending models is to use an approximation to Leave-One-Out (LOO) cross-validation, which is implemented by the <code>loo</code> function in the <strong>loo</strong> package:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Compare them with loo</span>
<span class="no">loo1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span>(<span class="no">post1</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">loo2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span>(<span class="no">post2</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">loo3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span>(<span class="no">post3</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">loo4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo</a></span>(<span class="no">post4</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)
(<span class="no">comp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span>(<span class="no">loo1</span>, <span class="no">loo2</span>, <span class="no">loo3</span>, <span class="no">loo4</span>))</pre></body></html></div>
<pre><code>      elpd_diff se_diff
post4   0.0       0.0  
post3  -3.5       2.8  
post2  -6.1       4.1  
post1 -42.4       8.7  </code></pre>
<p>In this case the fourth model is preferred as it has the highest expected log predicted density (<code>elpd_loo</code>) or, equivalently, the lowest value of the LOO Information Criterion (<code>looic</code>). The fourth model is preferred by a lot over the first model</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span>(<span class="no">loo1</span>, <span class="no">loo4</span>)</pre></body></html></div>
<pre><code>      elpd_diff se_diff
post4   0.0       0.0  
post1 -42.4       8.7  </code></pre>
<p>because the difference in <code>elpd</code> is so much larger than the standard error. However, the preference of the fourth model over the others isn’t as strong:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span>(<span class="no">loo3</span>, <span class="no">loo4</span>)</pre></body></html></div>
<pre><code>      elpd_diff se_diff
post4  0.0       0.0   
post3 -3.5       2.8   </code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/loo.stanreg.html">loo_compare</a></span>(<span class="no">loo2</span>, <span class="no">loo4</span>)</pre></body></html></div>
<pre><code>      elpd_diff se_diff
post4  0.0       0.0   
post2 -6.1       4.1   </code></pre>
</div>
<div id="the-posterior-predictive-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#the-posterior-predictive-distribution" class="anchor"></a>The posterior predictive distribution</h2>
<p>The posterior predictive distribution is the distribution of the outcome implied by the model after using the observed data to update our beliefs about the unknown parameters. When simulating observations from the posterior predictive distribution we use the notation <span class="math inline">\(y^{\rm rep}\)</span> (for <em>replicate</em>) when we use the same observations of <span class="math inline">\(X\)</span> that were used to estimate the model parameters. When <span class="math inline">\(X\)</span> contains new observations we use the notation <span class="math inline">\(\tilde{y}\)</span> to refer to the posterior predictive simulations.</p>
<p>Simulating data from the posterior predictive distribution using the observed predictors is useful for checking the fit of the model. Drawing from the posterior predictive distribution at interesting values of the predictors also lets us visualize how a manipulation of a predictor affects (a function of) the outcome(s).</p>
<div id="graphical-posterior-predictive-checks" class="section level3">
<h3 class="hasAnchor">
<a href="#graphical-posterior-predictive-checks" class="anchor"></a>Graphical posterior predictive checks</h3>
<p>The <code>pp_check</code> function generates a variety of plots comparing the observed outcome <span class="math inline">\(y\)</span> to simulated datasets <span class="math inline">\(y^{\rm rep}\)</span> from the posterior predictive distribution using the same observations of the predictors <span class="math inline">\(X\)</span> as we used to fit the model. He we show a few of the possible displays. The documentation at <code><a href="../reference/pp_check.stanreg.html">help("pp_check.stanreg", package = "rstanarm")</a></code> has details on all of the <code>pp_check</code> options.</p>
<p>First we’ll look at a plot directly comparing the distributions of <span class="math inline">\(y\)</span> and <span class="math inline">\(y^{\rm rep}\)</span>. The following call to <code>pp_check</code> will create a plot juxtaposing the histogram of <span class="math inline">\(y\)</span> and histograms of five <span class="math inline">\(y^{\rm rep}\)</span> datasets:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(<span class="no">post4</span>, <span class="kw">plotfun</span> <span class="kw">=</span> <span class="st">"hist"</span>, <span class="kw">nreps</span> <span class="kw">=</span> <span class="fl">5</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-pp_check1-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The idea is that if the model is a good fit to the data we should be able to generate data <span class="math inline">\(y^{\rm rep}\)</span> from the posterior predictive distribution that looks a lot like the observed data <span class="math inline">\(y\)</span>. That is, given <span class="math inline">\(y\)</span>, the <span class="math inline">\(y^{\rm rep}\)</span> we generate should be plausible.</p>
<p>Another useful plot we can make using <code>pp_check</code> shows the distribution of a test quantity <span class="math inline">\(T(y^{\rm rep})\)</span> compared to <span class="math inline">\(T(y)\)</span>, the value of the quantity in the observed data. When the argument <code>plotfun = "stat"</code> is specified, <code>pp_check</code> will simulate <span class="math inline">\(S\)</span> datasets <span class="math inline">\(y_1^{\rm rep}, \dots, y_S^{\rm rep}\)</span>, each containing <span class="math inline">\(N\)</span> observations. Here <span class="math inline">\(S\)</span> is the size of the posterior sample (the number of MCMC draws from the posterior distribution of the model parameters) and <span class="math inline">\(N\)</span> is the length of <span class="math inline">\(y\)</span>. We can then check if <span class="math inline">\(T(y)\)</span> is consistent with the distribution of <span class="math inline">\(\left(T(y_1^{\rm yep}), \dots, T(y_S^{\rm yep})\right)\)</span>. In the plot below we see that the mean of the observations is plausible when compared to the distribution of the means of the <span class="math inline">\(S\)</span> <span class="math inline">\(y^{\rm rep}\)</span> datasets:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(<span class="no">post4</span>, <span class="kw">plotfun</span> <span class="kw">=</span> <span class="st">"stat"</span>, <span class="kw">stat</span> <span class="kw">=</span> <span class="st">"mean"</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-pp_check2-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>Using <code>plotfun="stat_2d"</code> we can also specify two test quantities and look at a scatterplot:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(<span class="no">post4</span>, <span class="kw">plotfun</span> <span class="kw">=</span> <span class="st">"stat_2d"</span>, <span class="kw">stat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>))</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-pp_check3-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div id="generating-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-predictions" class="anchor"></a>Generating predictions</h3>
<p>The <code>posterior_predict</code> function is used to generate replicated data <span class="math inline">\(y^{\rm rep}\)</span> or predictions for future observations <span class="math inline">\(\tilde{y}\)</span>. Here we show how to use <code>posterior_predict</code> to generate predictions of the outcome <code>kid_score</code> for a range of different values of <code>mom_iq</code> and for both subpopulations defined by <code>mom_hs</code>.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">IQ_SEQ</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="fl">75</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="fl">135</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">y_nohs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.stanreg.html">posterior_predict</a></span>(<span class="no">post4</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">mom_hs</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">mom_iq</span> <span class="kw">=</span> <span class="no">IQ_SEQ</span>))
<span class="no">y_hs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.stanreg.html">posterior_predict</a></span>(<span class="no">post4</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">mom_hs</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">mom_iq</span> <span class="kw">=</span> <span class="no">IQ_SEQ</span>))
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">y_hs</span>)</pre></body></html></div>
<pre><code>[1] 4000   13</code></pre>
<p>We now have two matrices, <code>y_nohs</code> and <code>y_hs</code>. Each matrix has as many columns as there are values of <code>IQ_SEQ</code> and as many rows as the size of the posterior sample. One way to show the predictors is to plot the predictions for the two groups of kids side by side:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">2</span>), <span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(<span class="no">y_hs</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">outline</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>,<span class="fl">170</span>),
        <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Mom IQ"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Predicted Kid IQ"</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Mom HS"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">1</span>, <span class="kw">at</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">y_hs</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="no">IQ_SEQ</span>, <span class="kw">las</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">2</span>, <span class="kw">las</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span>(<span class="no">y_nohs</span>, <span class="kw">outline</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">axes</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>,<span class="fl">170</span>),
        <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Mom IQ"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Mom No HS"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="fl">1</span>, <span class="kw">at</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">y_hs</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="no">IQ_SEQ</span>, <span class="kw">las</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<p><img src="continuous_files/figure-html/continuous-kidiq-plot-predict-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="gamma-regression-example" class="section level1">
<h1 class="hasAnchor">
<a href="#gamma-regression-example" class="anchor"></a>Gamma Regression Example</h1>
<p>Gamma regression is often used when the response variable is continuous and positive, and the <em>coefficient of variation</em> (rather than the variance) is constant.</p>
<p>We’ll use one of the standard examples of Gamma regression, which is taken from McCullagh &amp; Nelder (1989). This example is also given in the documentation for R’s <code>glm</code> function. The outcome of interest is the clotting time of blood (in seconds) for “normal plasma diluted to nine different percentage concentrations with prothrombin-free plasma; clotting was induced by two lots of thromboplastin” (p. 300).</p>
<p>The help page for R’s <code>glm</code> function presents the example as follows:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">clotting</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">u</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="fl">80</span>,<span class="fl">100</span>),
    <span class="kw">lot1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">118</span>,<span class="fl">58</span>,<span class="fl">42</span>,<span class="fl">35</span>,<span class="fl">27</span>,<span class="fl">25</span>,<span class="fl">21</span>,<span class="fl">19</span>,<span class="fl">18</span>),
    <span class="kw">lot2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">69</span>,<span class="fl">35</span>,<span class="fl">26</span>,<span class="fl">21</span>,<span class="fl">18</span>,<span class="fl">16</span>,<span class="fl">13</span>,<span class="fl">12</span>,<span class="fl">12</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">lot1</span> ~ <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">u</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">clotting</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="no">Gamma</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">lot2</span> ~ <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">u</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">clotting</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="no">Gamma</span>))</pre></body></html></div>
<p>To fit the analogous Bayesian models we can simply substitute <code>stan_glm</code> for <code>glm</code> above. However, instead of fitting separate models we can also reshape the data slightly and fit a model interacting lot with plasma concentration:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">clotting2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">clotting</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">log_plasma</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">u</span>), <span class="fl">2</span>),
  <span class="kw">clot_time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">lot1</span>, <span class="no">lot2</span>),
  <span class="kw">lot_id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">u</span>)))
))

<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stan_glm.html">stan_glm</a></span>(<span class="no">clot_time</span> ~ <span class="no">log_plasma</span> * <span class="no">lot_id</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">clotting2</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="no">Gamma</span>,
                <span class="kw">prior_intercept</span> <span class="kw">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="kw">autoscale</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
                <span class="kw">prior</span> <span class="kw">=</span> <span class="fu"><a href="../reference/priors.html">normal</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="kw">autoscale</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
                <span class="kw">seed</span> <span class="kw">=</span> <span class="fl">12345</span>)</pre></body></html></div>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">fit</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)</pre></body></html></div>
<pre><code>stan_glm
 family:       Gamma [inverse]
 formula:      clot_time ~ log_plasma * lot_id
 observations: 18
 predictors:   4
------
                   Median MAD_SD
(Intercept)        -0.016  0.007
log_plasma          0.015  0.003
lot_id2            -0.008  0.014
log_plasma:lot_id2  0.008  0.006

Auxiliary parameter(s):
      Median MAD_SD
shape 7.724  2.661 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>In the output above, the estimate reported for <code>shape</code> is for the shape parameter of the Gamma distribution. The <em>reciprocal</em> of the shape parameter can be interpreted similarly to what <code>summary.glm</code> refers to as the dispersion parameter.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Gelman, A. and Hill, J. (2007). <em>Data Analysis Using Regression and Multilevel/Hierarchical Models.</em> Cambridge University Press, Cambridge, UK.</p>
<p>McCullagh, P. and Nelder, J. A. (1989). <em>Generalized Linear Models.</em> Chapman and Hall/CRC Press, New York.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
