<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Ordinal Regression Models with rstanarm • rstanarm</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rstanarm</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../dev-notes/index.html">Develop</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/users/interfaces/rstan.html">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/bayesplot.html">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/shinystan.html">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/loo.html">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/rstantools.html">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Estimating Ordinal Regression Models with rstanarm</h1>
                        <h4 class="author">Jonah Gabry and Ben Goodrich</h4>
            
            <h4 class="date">2017-06-16</h4>
          </div>

    
    
<div class="contents">
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_polr: Ordinal Models}
-->
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette explains how to estimate models for ordinal outcomes using the <code>stan_polr</code> function in the <strong>rstanarm</strong> package.</p>
<p>Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong> Package”</a>. This vignette focuses on Step 1.</p>
<p>One of the strengths of doing MCMC with Stan — as opposed to a Gibbs sampler — is that reparameterizations are essentially costless, which allows the user to specify priors on parameters that are either more intuitive, numerically stable, or computationally efficient without changing the posterior distribution of the parameters that enter the likelihood. Advantageous parameterizations are already built into the Stan programs used in the <strong>rstanarm</strong> package, so it is just a matter of using these vignettes to explain how the priors work in the context of these reparameterizations.</p>
</div>
<div id="likelihood" class="section level1">
<h1 class="hasAnchor">
<a href="#likelihood" class="anchor"></a>Likelihood</h1>
<p>Ordinal outcomes fall in one of <span class="math inline">\(J\)</span> categories. One way to motivate an ordinal model is to introduce a latent variable, <span class="math inline">\(y^\ast\)</span>, that is related to the observed outcomes via an observation mechanism: <span class="math display">\[y=\begin{cases}
1 &amp; \mbox{if }y^{\ast}&lt;\zeta_{1}\\
2 &amp; \mbox{if }\zeta_{1}\leq y^{\ast}&lt;\zeta_{2}\\
\vdots\\
J &amp; \mbox{if }\zeta_{J-1}\leq y^{\ast}
\end{cases},\]</span> where <span class="math inline">\(\boldsymbol{\zeta}\)</span> is a vector of cutpoints of length <span class="math inline">\(J-1\)</span>.</p>
<p>Then <span class="math inline">\(y^\ast\)</span> is modeled as a linear function of <span class="math inline">\(K\)</span> predictors <span class="math display">\[y^\ast = \mu + \epsilon = \mathbf{x}^\top \boldsymbol{\beta} + \epsilon,\]</span> where <span class="math inline">\(\epsilon\)</span> has mean zero and unit scale but can be specified as being drawn from one of several distributions. Note that there is no “intercept” in this model since the data cannot distinguish an intercept from the cutpoints. However, if <span class="math inline">\(J = 2\)</span>, then <span class="math inline">\(\zeta_1\)</span> can be referred to as either the cutpoint or the intercept.</p>
<p>A Bayesian can treat <span class="math inline">\(y^\ast\)</span> as another unknown parameter, although for computational efficiency the Stan code essentially integrates each <span class="math inline">\(y^\ast\)</span> out of the posterior distribution, leaving the posterior distribution of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\zeta}\)</span>. Nevertheless, it is useful to motivate the model theoretically as if <span class="math inline">\(y^\ast\)</span> were just an unknown parameter with a distribution truncated by the relevant element(s) of <span class="math inline">\(\boldsymbol{\zeta}\)</span>.</p>
</div>
<div id="priors" class="section level1">
<h1 class="hasAnchor">
<a href="#priors" class="anchor"></a>Priors</h1>
<p>If <span class="math inline">\(y^\ast\)</span> were observed we would simply have a linear regression model for it, and the description of the priors in the vignette entitled <a href="lm.html">“Estimating Linear Models with the <strong>rstanarm</strong> Package”</a> would apply directly. Another way to say the same thing is <em>conditional</em> on a realization of <span class="math inline">\(y^\ast\)</span>, we have a linear regression model and the description of the priors in the other <a href="lm.html">vignette</a> does apply (and should be read before continuing with this subsection).</p>
<p>The <code>stan_lm</code> function essentially specifies a prior on <span class="math inline">\(\boldsymbol{\theta} = \mathbf{R}^{-1} \boldsymbol{\beta}\)</span>, where <span class="math inline">\(\mathbf{R}\)</span> is the upper triangular matrix in the QR decomposition of the design matrix, <span class="math inline">\(\mathbf{X} = \mathbf{Q} \mathbf{R}\)</span>. Furthermore, in <code>stan_lm</code>, <span class="math inline">\(\sigma_{\epsilon} = \sigma_y \sqrt{1 - R^2}\)</span> where <span class="math inline">\(R^2\)</span> is the proportion of variance in the outcome that is attributable to the coefficients in a linear model.</p>
<p>The main difference in the context of a model for an ordinal outcome is that the scale of <span class="math inline">\(y^\ast\)</span> is not identified by the data. Thus, the ordinal model specifies that <span class="math inline">\(\sigma_{\epsilon} = 1\)</span>, which implies that <span class="math inline">\(\sigma_{y^\ast} = 1 / \sqrt{1 - R^2}\)</span> is an intermediate parameter rather than a primitive parameter.</p>
<p>It is somewhat more difficult to specify a prior value for the <span class="math inline">\(R^2\)</span> in an ordinal model because <span class="math inline">\(R^2\)</span> refers to the proportion of variance in the  <span class="math inline">\(y^\ast\)</span> that is attributable to the predictors under a linear model. In general, the <span class="math inline">\(R^2\)</span> tends to be lower in an ordinal model than in a linear model where the continuous outcome is observed.</p>
<p>The other difference is that an ordinal model does not have a global intercept but rather a vector of <span class="math inline">\(J-1\)</span> cutpoints. The implied prior on these cutpoints used by the <strong>rstanarm</strong> package is somewhat novel. The user instead specifies a Dirichlet prior on <span class="math inline">\(\Pr\left(y=j \, \left.\right| \, \overline{\mathbf{x}} \right)\)</span>, which is to say the prior probability of the outcome falling in each of the <span class="math inline">\(J\)</span> categories given that the predictors are at their sample means. The Dirichlet prior is for a simplex random variable, whose elements are non-negative and sum to <span class="math inline">\(1\)</span>. The Dirichlet PDF can be written as <span class="math display">\[f\left(\boldsymbol{\pi}|\boldsymbol{\alpha}\right) \propto 
\prod_{j=1}^J{\pi_j^{\alpha_j - 1}}, \]</span> where <span class="math inline">\(\boldsymbol{\pi}\)</span> is a simplex vector such that <span class="math inline">\(\pi_j = \Pr\left(y=j \, \left.\right| \, \overline{\mathbf{x}} \right)\)</span>.</p>
<p>The Dirichlet prior is one of the easiest to specify because the so-called “concentration” hyperparameters <span class="math inline">\(\boldsymbol{\alpha}\)</span> can be interpreted as prior counts, i.e., prior observations for each of the J categories (although they need not be integers). If <span class="math inline">\(\alpha_j = 1\)</span> for every <span class="math inline">\(j\)</span> (the default used by <strong>rstanarm</strong>) then the Dirichlet prior is jointly uniform over the space of these simplexes. This corresponds to a prior count of one observation falling in each of the <span class="math inline">\(J\)</span> ordinal categories when the predictors are at their sample means and conveys the reasonable but weak prior information that no category has probability zero. If, for each <span class="math inline">\(j\)</span>, <span class="math inline">\(\alpha_j = \alpha &gt; 1\)</span> then the prior mode is that the <span class="math inline">\(J\)</span> categories are equiprobable, with prior probability <span class="math inline">\(1/J\)</span> of the outcome falling in each of the <span class="math inline">\(J\)</span> categories. The larger the value of <span class="math inline">\(\alpha\)</span> the more sharply peaked the distribution is at the mode.</p>
<p>The <span class="math inline">\(j\)</span>-th cutpoint <span class="math inline">\(\zeta_j\)</span> is then given by <span class="math display">\[\zeta_j = F_{y^\ast}^{-1}\left(\sum_{i=1}^j{\pi_i}\right),\]</span> where <span class="math inline">\(F_{y^\ast}^{-1}\)</span> is an inverse CDF function, which depends on the assumed distribution of <span class="math inline">\(y^\ast\)</span>. Common choices include the normal and logistic distributions. The scale parameter of this distribution is again <span class="math inline">\(\sigma_{y^\ast} = 1/\sqrt{1 - R^2}\)</span>. In short, by making each <span class="math inline">\(\zeta_j\)</span> a function of <span class="math inline">\(\boldsymbol{\pi}\)</span>, it allows us to specify a Dirichlet prior on <span class="math inline">\(\boldsymbol{\pi}\)</span>, which is simpler than specifying a prior on <span class="math inline">\(\boldsymbol{\zeta}\)</span> directly.</p>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>In this section, we start with an ordinal model of tobacco consumption as a function of age and alcohol consumption. Frequentist estimates can be obtained using the <code>polr</code> function in the <strong>MASS</strong> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MASS)
<span class="kw">print</span>(<span class="kw">polr</span>(tobgp ~<span class="st"> </span>agegp +<span class="st"> </span>alcgp, <span class="dt">data =</span> esoph), <span class="dt">digits =</span> <span class="dv">1</span>)</code></pre></div>
<p>To obtain Bayesian estimates, we prepend <code>stan_</code> and specify the priors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstanarm)
post0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_polr.html">stan_polr</a></span>(tobgp ~<span class="st"> </span>agegp +<span class="st"> </span>alcgp, <span class="dt">data =</span> esoph, 
                   <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">R2</a></span>(<span class="fl">0.25</span>), <span class="dt">prior_counts =</span> <span class="kw"><a href="../reference/priors.html">dirichlet</a></span>(<span class="dv">1</span>),
                   <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED, <span class="dt">iter =</span> <span class="dv">200</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(post0, <span class="dt">digits =</span> <span class="dv">1</span>)</code></pre></div>
<p>The point estimates, represented by the posterior medians, are qualitatively similar to the maximum-likelihood estimates but are somewhat shrunk toward zero due to the regularizing prior on the coefficients. Since these cutpoints are actually <em>known</em>, it would be more appropriate for the model to take that into account, but <code>stan_polr</code> does not currently support that.</p>
<p>Next, we utilize an example from the <strong>MASS</strong> package where low birthweight is the binary outcome of interest. First, we recode some of the variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"birthwt"</span>, <span class="dt">package =</span> <span class="st">"MASS"</span>)
birthwt$race &lt;-<span class="st"> </span><span class="kw">factor</span>(birthwt$race, <span class="dt">levels =</span> <span class="dv">1</span>:<span class="dv">3</span>, 
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"other"</span>))
birthwt$bwt &lt;-<span class="st"> </span>birthwt$bwt /<span class="st"> </span><span class="dv">1000</span> <span class="co"># convert from grams to kilograms</span>
birthwt$low &lt;-<span class="st"> </span><span class="kw">factor</span>(birthwt$low, <span class="dt">levels =</span> <span class="dv">0</span>:<span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))</code></pre></div>
<p>It is usually a good idea to rescale variables by constants so that all the numbers are in single or double digits. We start by estimating a linear model for birthweight in kilograms, flipping the sign so that positive coefficients are associated with <em>lower</em> birthweights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_lm.html">stan_lm</a></span>(-bwt ~<span class="st"> </span>smoke +<span class="st"> </span>age +<span class="st"> </span>race +<span class="st"> </span>ptl +<span class="st"> </span>ht +<span class="st"> </span>ftv,
                 <span class="dt">data =</span> birthwt, <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">R2</a></span>(<span class="fl">0.5</span>), 
                 <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(post1)</code></pre></div>
<p>Next, we estimate an “ordinal” model for the incidence of low birthweight, which is defined as a birth weight of less than <span class="math inline">\(2.5\)</span> kilograms. Even though this outcome is binary, a binary variable is a special case of an ordinal variable with <span class="math inline">\(J=2\)</span> categories and is acceptable to <code>stan_polr</code>. We can think of <code>bwt</code> as something proportional to <span class="math inline">\(y^\ast\)</span> and pretend that it is not observed, forcing us to estimate an ordinal model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_polr.html">stan_polr</a></span>(low ~<span class="st"> </span>smoke +<span class="st"> </span>age +<span class="st"> </span>race +<span class="st"> </span>ptl +<span class="st"> </span>ht +<span class="st"> </span>ftv, <span class="dt">data =</span> birthwt,
                   <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">R2</a></span>(<span class="fl">0.5</span>), <span class="dt">prior_counts =</span> <span class="kw"><a href="../reference/priors.html">dirichlet</a></span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)), 
                   <span class="dt">method =</span> <span class="st">"probit"</span>, 
                   <span class="dt">chains =</span> CHAINS, <span class="dt">cores =</span> CORES, <span class="dt">seed =</span> SEED)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(post2))</code></pre></div>
<p>This prior seems to have worked well in this case because none of the points in the plot are above <span class="math inline">\(0.5\)</span>, which would have indicated the the posterior is very sensitive to those observations. If we compare the estimated coefficients,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="kw">cbind</span>(<span class="dt">Linear =</span> <span class="kw">coef</span>(post1), <span class="dt">Ordinal =</span> <span class="kw">coef</span>(post2), 
            <span class="dt">Rescaled =</span> <span class="kw">coef</span>(post1) /<span class="st"> </span><span class="kw"><a href="../reference/stanreg-methods.html">sigma</a></span>(post1)), <span class="dv">3</span>)</code></pre></div>
<p>they have the same signs and similar magnitudes, with the exception of the “Intercept”. In an ordinal model where the outcome only has <span class="math inline">\(J=2\)</span> categories, this “Intercept” is actually <span class="math inline">\(\zeta_1\)</span>, but it is more conventional to call it the “Intercept” so that it agrees with <code>stan_glm</code> when <code>family = binomial(link = 'probit')</code>. Recall that <span class="math inline">\(\sigma_{\epsilon} = 1\)</span> in an ordinal model, so if we rescale the coefficients from a linear model by dividing by the posterior median of <span class="math inline">\(\sigma\)</span>, the resulting coefficients are even closer to those of the ordinal model.</p>
<p>This illustrates the fundamental similarity between a linear model for a continuous observed outcome and a linear model for a latent <span class="math inline">\(y^\ast\)</span> that generates an ordinal observed outcome. The main difference is when the outcome is continuous and observed, we can estimate the scale of the errors meaningfully. When the outcome is ordinal, we can only fix the scale of the latent errors to <span class="math inline">\(1\)</span> arbitrarily.</p>
<p>Finally, when <span class="math inline">\(J = 2\)</span>, the <code>stan_polr</code> function allows you to specify non-<code>NULL</code> values of the <code>shape</code> and <code>rate</code> arguments, which implies a “scobit” likelihood where the probability of success is given by <span class="math inline">\(F\left(y^\ast \right)^\alpha\)</span>, where <span class="math inline">\(F\left(\right)\)</span> is the logistic CDF and <span class="math inline">\(\alpha &gt; 0\)</span> is a skewing parameter that has a gamma prior with a given <code>shape</code> and <code>rate</code>. If <span class="math inline">\(\alpha \neq 1\)</span>, then the relationship between <span class="math inline">\(y^\ast\)</span> and the probability of success is asymmetric. In principle, it seems appropriate to estimate <span class="math inline">\(\alpha\)</span> but in practice, a lot of data is needed to estimate <span class="math inline">\(\alpha\)</span> with adequate precision. In the previous example, if we specify <code>shape = 2</code> and <code>rate = 2</code> to reflect the prior beliefs that <span class="math inline">\(\alpha\)</span> is expected to be <span class="math inline">\(1\)</span> but has a variance of <span class="math inline">\(\frac{1}{2}\)</span>, then the <code>loo</code> calculation yields many Pareto shape parameters that are excessively large. However, with more than <span class="math inline">\(189\)</span> observations, such a model may be more fruitful.</p>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>The posterior distribution for an ordinal model requires priors on the coefficients and the cutpoints. The priors used by the <code>stan_polr</code> function are unconventional but should work well for a variety of problems. The prior on the coefficients is essentially the same as that used by the <code>stan_lm</code> function but omits a scale parameter because the standard deviation of the latent <span class="math inline">\(y^\ast\)</span> is not identified by the data. The cutpoints are conditionally deterministic given a simplex vector for the probability of falling in each of the <span class="math inline">\(J\)</span> ordinal categories given that the predictors are at their sample means. Thus, a Dirichlet prior — which is relatively easy to specify and has a good default of jointly uniform — on this simplex completes the posterior distribution.</p>
<p>This approach provides an alternative to <code>stan_glm</code> with <code>family = binomial()</code> even if the outcome variable has only two categories. The <code>stan_glm</code> function has more options for the prior on the coefficients and the prior on the intercept (which can be interpreted as the first cutpoint when <span class="math inline">\(J = 2\)</span>). However, it may be more difficult to obtain efficient sampling with those priors.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#likelihood">Likelihood</a></li>
      <li><a href="#priors">Priors</a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
