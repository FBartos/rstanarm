<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling Rates/Proportions using Beta Regression with rstanarm • rstanarm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modeling Rates/Proportions using Beta Regression with rstanarm">
<meta property="og:description" content="">
<meta property="og:image" content="https://mc-stan.org/rstanarm/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstanarm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.19.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../dev-notes/index.html">Develop</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Modeling Rates/Proportions using Beta Regression with rstanarm</h1>
                        <h4 class="author">Imad Ali, Jonah Gabry and Ben Goodrich</h4>
            
            <h4 class="date">2019-10-04</h4>
      
      
      <div class="hidden name"><code>betareg.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{stan_betareg: Models for Rate/Proportion Data}
-->
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(bayesplot)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(bayesplot<span class="op">::</span><span class="kw"><a href="https://mc-stan.org/bayesplot/reference/theme_default.html">theme_default</a></span>())</a></code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette explains how to model continuous outcomes on the open unit interval using the <code>stan_betareg</code> function in the <strong>rstanarm</strong> package.</p>
<p>The four steps of a Bayesian analysis are</p>
<ol style="list-style-type: decimal">
<li>Specify a joint distribution for the outcome(s) and all the unknowns, which typically takes the form of a marginal prior distribution for the unknowns multiplied by a likelihood for the outcome(s) conditional on the unknowns. This joint distribution is proportional to a posterior distribution of the unknowns conditional on the observed data</li>
<li>Draw from posterior distribution using Markov Chain Monte Carlo (MCMC).</li>
<li>Evaluate how well the model fits the data and possibly revise the model.</li>
<li>Draw from the posterior predictive distribution of the outcome(s) given interesting values of the predictors in order to visualize how a manipulation of a predictor affects (a function of) the outcome(s).</li>
</ol>
<p>Steps 3 and 4 are covered in more depth by the vignette entitled <a href="rstanarm.html">“How to Use the <strong>rstanarm</strong> Package”</a>. This vignette focuses on Step 1 when the likelihood is the product of beta distributions.</p>
</div>
<div id="likelihood" class="section level1">
<h1 class="hasAnchor">
<a href="#likelihood" class="anchor"></a>Likelihood</h1>
<p>Beta regression uses the beta distribution as the likelihood for the data, <span class="math display">\[
f(y_i | a, b) = \frac{y_i^{(a-1)}(1-y_i)^{(b-1)}}{B(a,b)}
\]</span> where <span class="math inline">\(B(\cdot)\)</span> is the beta function. The shape parameters for the distribution are <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and enter into the model according to the following transformations, <span class="math display">\[
a = \mu\cdot\phi \\
b = (1-\mu)\cdot\phi
\]</span></p>
<p>Let <span class="math inline">\(g_1(\cdot)\)</span> be some link function. Then, in the specification of the shape parameters above, <span class="math inline">\(\mu = g_1^{-1}(\mathbf{X}\boldsymbol{\beta})\)</span>, where <span class="math inline">\(\boldsymbol{X}\)</span> is a <span class="math inline">\(N\times K\)</span> dimensional matrix of predictors, and <span class="math inline">\(\boldsymbol{\beta}\)</span> is a <span class="math inline">\(K\)</span> dimensional vector of parameters associated with each predictor.</p>
<p>In the simplest case (with only one set of regressors), <span class="math inline">\(\phi\)</span> is a scalar parameter. Alternatively, it is possible to model <span class="math inline">\(\phi\)</span> using a second set of regressors <span class="math inline">\(\mathbf{Z}\)</span>. In this context let <span class="math inline">\(g_2(\cdot)\)</span> be some link function that is not necessarily identical to <span class="math inline">\(g_1(\cdot)\)</span>. Then <span class="math inline">\(\phi = g_2^{-1}(\mathbf{Z}\boldsymbol{\gamma})\)</span>, where <span class="math inline">\(\boldsymbol{\gamma}\)</span> is a <span class="math inline">\(J\)</span> dimensional vector of parameters associated with the <span class="math inline">\(N\times J\)</span> dimensional matrix of predictors <span class="math inline">\(\mathbf{Z}\)</span>.</p>
<p>After substituting the shape parameter values in, the likelihood used in beta regression takes the following form, <span class="math display">\[
f(y_i | \mu, \phi) = \frac{y_i^{(\mu\phi-1)}(1-y_i)^{((1-\mu)\phi-1)}}{B(\mu\phi,(1-\mu)\phi)}
\]</span></p>
</div>
<div id="priors" class="section level1">
<h1 class="hasAnchor">
<a href="#priors" class="anchor"></a>Priors</h1>
<p>A full Bayesian analysis requires specifying prior distributions <span class="math inline">\(f(\boldsymbol{\beta})\)</span> and <span class="math inline">\(f(\phi)\)</span> for the vector of regression coefficients and <span class="math inline">\(\phi\)</span>. When using <code>stan_betareg</code>, these distributions can be set using the <code>prior_intercept</code>, <code>prior</code>, and <code>prior_phi</code> arguments. The <code>stan_betareg</code> function supports a variety of prior distributions, which are explained in the <strong>rstanarm</strong> documentation (<code><a href="https://rdrr.io/r/utils/help.html">help(priors, package = 'rstanarm')</a></code>).</p>
<p>When modeling <span class="math inline">\(\phi\)</span> with a linear predictor a full Bayesian analysis requires specifying the prior distributions <span class="math inline">\(f(\boldsymbol{\beta})\)</span> and <span class="math inline">\(f(\boldsymbol{\gamma})\)</span>. In <code>stan_betareg</code> the prior distributions on <span class="math inline">\(\boldsymbol{\gamma}\)</span> can be set using the <code>prior_intercept_z</code> and <code>prior_z</code> arguments.</p>
<p>As an example, suppose we have <span class="math inline">\(K\)</span> predictors and believe — prior to seeing the data — that <span class="math inline">\(\beta_1, \dots, \beta_K\)</span> and <span class="math inline">\(\phi\)</span> are as likely to be positive as they are to be negative, but are highly unlikely to be far from zero. These beliefs can be represented by normal distributions with mean zero and a small scale (standard deviation). To give <span class="math inline">\(\phi\)</span> and each of the <span class="math inline">\(\beta\)</span>s this prior (with a scale of 1, say), in the call to <code>stan_betareg</code> we would include the arguments <code>prior_intercept = normal(0,1)</code>, <code>prior = normal(0,1)</code>, and <code>prior_phi = normal(0,1)</code>.</p>
<p>If, on the other hand, we have less a priori confidence that the parameters will be close to zero then we could use a larger scale for the normal distribution and/or a distribution with heavier tails than the normal like the Student t distribution. <strong>Step 1</strong> in the “How to Use the <strong>rstanarm</strong> Package” vignette discusses one such example.</p>
<p>After fitting the model we can use the <code>prior_summary</code> function to print information about the prior distributions used when fitting the model.</p>
</div>
<div id="posterior" class="section level1">
<h1 class="hasAnchor">
<a href="#posterior" class="anchor"></a>Posterior</h1>
<p>When using only a <em>single set of regressors</em>, the posterior distribution of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\phi\)</span> is proportional to the product of the likelihood contributions, the <span class="math inline">\(K\)</span> priors on the <span class="math inline">\(\beta_k\)</span> parameters, and <span class="math inline">\(\phi\)</span>, <span class="math display">\[
f(\boldsymbol{\beta},\phi|\mathbf{y},\mathbf{X}) \propto 
\prod_{i=1}^N f(y_i | a, b) \times 
\prod_{k=1}^K f(\beta_k) \times
f(\phi)
\]</span></p>
<p>When using <em>two sets of regressors</em>, the posterior distribution of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\gamma}\)</span> is proportional to the product of the likelihood contribution, the <span class="math inline">\(K\)</span> priors on the <span class="math inline">\(\beta_k\)</span> parameters, and the <span class="math inline">\(J\)</span> priors on the <span class="math inline">\(\gamma_j\)</span> parameters,</p>
<p><span class="math display">\[
f(\boldsymbol{\beta},\boldsymbol{\gamma}|\mathbf{y},\mathbf{X}) \propto 
\prod_{i=1}^N f(y_i | a, b) \times 
\prod_{k=1}^K f(\beta_k) \times
\prod_{j=1}^J f(\gamma_j)
\]</span></p>
</div>
<div id="an-example-using-simulated-data" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-using-simulated-data" class="anchor"></a>An Example Using Simulated Data</h1>
<p>In this example the outcome variable <span class="math inline">\(\mathbf{y}\)</span> is simulated in a way that warrants the use of beta regression. It is worth mentioning that the data generation process is quite convoluted, which is apparent in the identification of the likelihood above.</p>
<p>The data simulated below uses the logistic link function on the first set of regressors and the log link function on the second set of regressors.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">SEED &lt;-<span class="st"> </span><span class="dv">1234</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(SEED)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">eta &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="fl">-0.2</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">gamma &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.8</span>, <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">N &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(N, <span class="dv">2</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(N, <span class="dv">0</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">mu &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(<span class="dt">link =</span> logit)<span class="op">$</span><span class="kw">linkinv</span>(eta[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>eta[<span class="dv">2</span>]<span class="op">*</span>x)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">phi &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(<span class="dt">link =</span> log)<span class="op">$</span><span class="kw">linkinv</span>(gamma[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>gamma[<span class="dv">2</span>]<span class="op">*</span>z)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span>(N, mu <span class="op">*</span><span class="st"> </span>phi, (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu) <span class="op">*</span><span class="st"> </span>phi)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">dat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(y, x, z))</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(dat<span class="op">$</span>y, <span class="dt">col =</span> <span class="st">"darkgrey"</span>, <span class="dt">border =</span> F, <span class="dt">main =</span> <span class="st">"Distribution of Outcome Variable"</span>, <span class="dt">xlab =</span> <span class="st">"y"</span>, <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">freq =</span> F)</a></code></pre></div>
<p><img src="betareg_files/figure-html/simulated-data-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The model can be fit by calling <code>stan_betareg</code>, using the appropriate link functions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rstanarm)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">fit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">|</span><span class="st"> </span>z, <span class="dt">data =</span> dat, <span class="dt">link =</span> <span class="st">"logit"</span>, <span class="dt">link.phi =</span> <span class="st">"log"</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                     <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">seed =</span> <span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">fit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(y <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>x , <span class="dt">data =</span> dat, <span class="dt">link =</span> <span class="st">"logit"</span>, <span class="dt">link.phi =</span> <span class="st">"log"</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                     <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">seed =</span> <span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(fit1), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(fit2), <span class="dv">2</span>)</a></code></pre></div>
<pre><code>      (Intercept)                 x (phi)_(Intercept)           (phi)_z 
             0.94             -0.20              1.84              0.32 </code></pre>
<pre><code>                x (phi)_(Intercept) 
             0.00              1.08 </code></pre>
<p>For clarity we can use <code>prior_summary</code> to print the information about the prior distributions used to fit the models. The priors used in <code>fit1</code> are provided below.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/prior_summary.stanreg.html">prior_summary</a></span>(fit1)</a></code></pre></div>
<pre><code>Priors for model 'fit1' 
------
Intercept (after predictors centered)
 ~ normal(location = 0, scale = 10)

Coefficients
  Specified prior:
    ~ normal(location = 0, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 0, scale = 1.2)

Intercept_z (after predictors centered)
 ~ normal(location = 0, scale = 10)

Coefficients_z
  Specified prior:
    ~ normal(location = 0, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 0, scale = 1.2)
------
See help('prior_summary.stanreg') for more details</code></pre>
<p>The usual posterior analyses are available in <strong>rstanarm</strong>. The plots below illustrate simulated values of the outcome variable. The incorrect model noticeably fails to capture the top of the distribution consistently in comparison to the true model.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(bayesplot)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="https://mc-stan.org/bayesplot/reference/bayesplot_grid.html">bayesplot_grid</a></span>(</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(fit1), <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(fit2), </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>),  </a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">4</span>), </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="dt">titles =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"True Model: y ~ x | z"</span>, <span class="st">"False Model: y ~ x - 1"</span>),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  <span class="dt">grid_args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">)</a></code></pre></div>
<p><img src="betareg_files/figure-html/simulated-analysis-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>We can also compare models by evaluating the expected log pointwise predictive density (<code>elpd</code>), which can be calculated using the <code>loo</code> method, which provides an interface for <strong>rstanarm</strong> models to the functionality in the <strong>loo</strong> package.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">loo1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(fit1)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">loo2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(fit2)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw"><a href="../reference/loo.stanreg.html">loo_compare</a></span>(loo1, loo2)</a></code></pre></div>
<pre><code>     elpd_diff se_diff
fit1   0.0       0.0  
fit2 -80.1      11.9  </code></pre>
<p>The difference in <code>elpd</code> is negative indicating that the expected predictive accuracy for the first model is higher.</p>
</div>
<div id="an-example-using-gasoline-data" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-using-gasoline-data" class="anchor"></a>An Example Using Gasoline Data</h1>
<p>In some applied contexts it may be necessary to work with an outcome variable that is a proportion. If the proportion is bound on the open unit interval then beta regression can be considered a reasonable estimation method. The <code>betareg</code> package provides a dataset on the proportion of crude oil converted to gasoline after distillation and fractionation. This variable is defined as yield. Below <code>stan_betareg</code> is used to model yield as a function of temperature, pressure, and the batch of conditions.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rstanarm)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"GasolineYield"</span>, <span class="dt">package =</span> <span class="st">"betareg"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">gas_fit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(yield <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>batch, <span class="dt">data =</span> GasolineYield, <span class="dt">link =</span> <span class="st">"logit"</span>,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">                         <span class="dt">seed =</span> <span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">gas_fit2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stan_betareg.html">stan_betareg</a></span>(yield <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>batch <span class="op">|</span><span class="st"> </span>pressure,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">                         <span class="dt">data =</span> GasolineYield, <span class="dt">link =</span> <span class="st">"logit"</span>,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">                         <span class="dt">seed =</span> <span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(gas_fit1), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(gas_fit2), <span class="dv">2</span>)</a></code></pre></div>
<pre><code>(Intercept)        temp      batch1      batch2      batch3      batch4 
      -5.13        0.01        1.34        0.92        1.13        0.76 
     batch5      batch6      batch7      batch8      batch9       (phi) 
       0.79        0.71        0.29        0.26        0.13       12.11 </code></pre>
<pre><code>      (Intercept)              temp            batch1            batch2 
            -6.08              0.01              1.70              1.29 
           batch3            batch4            batch5            batch6 
             1.53              1.04              1.11              1.02 
           batch7            batch8            batch9 (phi)_(Intercept) 
             0.52              0.48              0.36              5.43 
   (phi)_pressure 
             0.04 </code></pre>
<p>The plots below illustrate simulated values of gasoline yield. While the first model accounts for variation in batch conditions its predictions looks somewhat uniform rather than resembling the peaked and right-skewed behavior of the true data. The second model does a somewhat better job at capturing the shape of the distribution, however its location is off as it is centered around 0.50 rather than 0.20.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="https://mc-stan.org/bayesplot/reference/bayesplot_grid.html">bayesplot_grid</a></span>(</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(gas_fit1), <span class="kw"><a href="../reference/pp_check.stanreg.html">pp_check</a></span>(gas_fit2), </a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>),  </a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">5</span>), </a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  <span class="dt">titles =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gas_fit1"</span>, <span class="st">"gas_fit2"</span>),</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">  <span class="dt">grid_args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">)</a></code></pre></div>
<p><img src="betareg_files/figure-html/gas-analysis-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">gas_loo1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(gas_fit1)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">gas_loo2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loo.stanreg.html">loo</a></span>(gas_fit2)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw"><a href="../reference/loo.stanreg.html">loo_compare</a></span>(gas_loo1, gas_loo2)</a></code></pre></div>
<pre><code>         elpd_diff se_diff
gas_fit2   0.0       0.0  
gas_fit1 -34.2       3.6  </code></pre>
<p>Evaluating the expected log predictive distribution using <code>loo</code> reveals that the second of the two models is preferred.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Ferrari, SLP and Cribari-Neto, F (2004) “Beta Regression for Modeling Rates and Proportions”. <em>Journal of Applied Statistics.</em> Vol. 31, No. 07, p799-815.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#likelihood">Likelihood</a></li>
      <li><a href="#priors">Priors</a></li>
      <li><a href="#posterior">Posterior</a></li>
      <li><a href="#an-example-using-simulated-data">An Example Using Simulated Data</a></li>
      <li><a href="#an-example-using-gasoline-data">An Example Using Gasoline Data</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonah Gabry, Ben Goodrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
